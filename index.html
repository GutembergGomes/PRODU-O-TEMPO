<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GGOMES-LOG - Sistema de Acompanhamento de Produção</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.28/jspdf.plugin.autotable.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        primary: {
                            50: '#f0f0ff',
                            100: '#e1e0ff',
                            200: '#c7c5fe',
                            300: '#a7a4fd',
                            400: '#8c7af8',
                            500: '#7a63f1',
                            600: '#7250e6',
                            700: '#5D5CDE', // Nossa cor principal
                            800: '#4940b0',
                            900: '#373583',
                        },
                        secondary: {
                            50: '#f1fcf7',
                            100: '#dbf7e8',
                            200: '#b9edd4',
                            300: '#88dbb8',
                            400: '#52bf95',
                            500: '#35a57d',
                            600: '#258566',
                            700: '#206b54',
                            800: '#1d5645',
                            900: '#19473a',
                        },
                        accent: {
                            50: '#fff8eb',
                            100: '#ffecc6',
                            200: '#ffd886',
                            300: '#ffbc46',
                            400: '#ffa620',
                            500: '#fe8605',
                            600: '#e56506',
                            700: '#bd4708',
                            800: '#983a0f',
                            900: '#7c3010',
                        }
                    },
                    fontFamily: {
                        sans: ['Inter', 'sans-serif']
                    },
                    boxShadow: {
                        'card': '0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06)',
                        'card-hover': '0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05)',
                    },
                    animation: {
                        'fade-in': 'fadeIn 0.3s ease-in-out',
                        'slide-in': 'slideIn 0.3s ease-out',
                    },
                    keyframes: {
                        fadeIn: {
                            '0%': { opacity: '0' },
                            '100%': { opacity: '1' },
                        },
                        slideIn: {
                            '0%': { transform: 'translateY(-10px)', opacity: '0' },
                            '100%': { transform: 'translateY(0)', opacity: '1' },
                        },
                    }
                }
            }
        }
    </script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
        
        * {
            transition: background-color 0.3s, border-color 0.3s, color 0.3s;
        }
        
        .card-hover {
            transition: all 0.3s ease;
        }
        
        .card-hover:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        }
        
        .fade-in {
            animation: fadeIn 0.3s ease-in-out;
        }
        
        @keyframes fadeIn {
            0% { opacity: 0; }
            100% { opacity: 1; }
        }
        
        .slide-in {
            animation: slideIn 0.3s ease-out;
        }
        
        @keyframes slideIn {
            0% { transform: translateY(-10px); opacity: 0; }
            100% { transform: translateY(0); opacity: 1; }
        }
        
        .rotate-on-hover:hover {
            transform: rotate(15deg);
            transition: transform 0.3s ease;
        }
        
        /* Estilizando a barra de rolagem */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }
        
        ::-webkit-scrollbar-track {
            background: rgba(0, 0, 0, 0.05);
            border-radius: 10px;
        }
        
        ::-webkit-scrollbar-thumb {
            background: rgba(93, 92, 222, 0.5);
            border-radius: 10px;
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: rgba(93, 92, 222, 0.8);
        }
        
        /* Loader */
        .loader {
            border: 3px solid rgba(93, 92, 222, 0.1);
            border-radius: 50%;
            border-top: 3px solid #5D5CDE;
            width: 24px;
            height: 24px;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* Toast notifications */
        .toast {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 9999;
            animation: slideInRight 0.3s, fadeOut 0.5s 2.5s forwards;
            border-left: 4px solid;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }
        
        @keyframes slideInRight {
            0% { transform: translateX(100%); opacity: 0; }
            100% { transform: translateX(0); opacity: 1; }
        }
        
        @keyframes fadeOut {
            0% { opacity: 1; }
            100% { opacity: 0; visibility: hidden; }
        }
        
        .toast-success { border-color: #34D399; }
        .toast-error { border-color: #F87171; }
        .toast-warning { border-color: #FBBF24; }
        .toast-info { border-color: #60A5FA; }
        
        /* Auth Container Styles */
        .auth-container {
            background-color: rgba(0, 0, 0, 0.4);
            backdrop-filter: blur(5px);
        }

        /* Progress Bar */
        .progress-bar {
            height: 8px;
            border-radius: 4px;
            transition: width 0.6s ease;
        }

        /* Active Tabs */
        .tab-active {
            border-bottom: 2px solid;
            color: #5D5CDE;
        }
        .dark .tab-active {
            color: #a7a4fd;
        }
    </style>
    
    <!-- Detectar modo escuro -->
    <script>
        if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
            document.documentElement.classList.add('dark');
        }
        
        window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', event => {
            if (event.matches) {
                document.documentElement.classList.add('dark');
            } else {
                document.documentElement.classList.remove('dark');
            }
        });
    </script>
</head>
<body class="bg-gray-50 dark:bg-gray-900 text-gray-800 dark:text-gray-100 min-h-screen">
    <!-- Authentication Container -->
    <div id="auth-container" class="fixed inset-0 auth-container flex items-center justify-center z-50 fade-in">
        <div class="bg-white dark:bg-gray-800 p-8 rounded-lg shadow-lg w-full max-w-md">
            <div class="text-center mb-6">
                <h2 class="text-2xl font-bold text-primary-700 dark:text-primary-300">GGOMES-LOG</h2>
                <p class="text-gray-600 dark:text-gray-400">Sistema de Acompanhamento de Produção</p>
            </div>
            
            <!-- Login Form -->
            <div id="login-form" class="space-y-4">
                <div>
                    <label for="login-email" class="block mb-1 text-gray-700 dark:text-gray-300">Email</label>
                    <input type="email" id="login-email" class="w-full px-4 py-2 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-800 dark:text-white text-base focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-transparent" placeholder="seu@email.com" required>
                </div>
                <div>
                    <label for="login-password" class="block mb-1 text-gray-700 dark:text-gray-300">Senha</label>
                    <input type="password" id="login-password" class="w-full px-4 py-2 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-800 dark:text-white text-base focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-transparent" placeholder="********" required>
                </div>
                <button id="btn-login" class="w-full bg-primary-600 hover:bg-primary-700 text-white px-4 py-2 rounded-lg transition">Entrar</button>
                
                <!-- Mensagem sobre criação de usuários -->
                <div class="text-center text-sm text-gray-600 dark:text-gray-400 mt-4">
                    <p>Novos usuários devem ser cadastrados por um administrador</p>
                </div>
            </div>
            
            <!-- Auth loader -->
            <div id="auth-loader" class="flex items-center justify-center py-4 hidden">
                <div class="loader mr-2"></div>
                <span class="text-gray-600 dark:text-gray-400">Aguarde...</span>
            </div>
        </div>
    </div>
    
    <!-- Toast notifications container -->
    <div id="toast-container"></div>
    
    <!-- Main container -->
    <div id="app-container" class="flex flex-col h-screen hidden">
        <!-- Header -->
        <header class="bg-white dark:bg-gray-800 shadow-md px-4 py-3 flex justify-between items-center">
            <div class="flex items-center space-x-3">
                <div class="text-primary-700 dark:text-primary-300">
                    <i class="fas fa-tractor text-2xl"></i>
                </div>
                <h1 class="text-xl md:text-2xl font-bold text-primary-700 dark:text-primary-300">GGOMES-LOG - Sistema de Acompanhamento de Produção</h1>
            </div>
            <div class="flex items-center space-x-4">
                <div class="text-sm text-gray-600 dark:text-gray-400 hidden md:block">
                    <span id="user-role-badge" class="px-2 py-1 rounded text-xs font-medium"></span>
                    <span id="user-name">Usuário</span>
                </div>
                <button id="toggle-theme" class="p-2 rounded-full hover:bg-gray-200 dark:hover:bg-gray-700 transition">
                    <i class="fas fa-sun text-yellow-500 dark:hidden"></i>
                    <i class="fas fa-moon text-blue-300 hidden dark:block"></i>
                </button>
                <button id="btn-export-data" class="bg-secondary-600 hover:bg-secondary-700 text-white px-4 py-2 rounded-lg flex items-center">
                    <i class="fas fa-download mr-2"></i>
                    <span class="hidden md:inline">Exportar Dados</span>
                </button>
                <button id="btn-logout" class="bg-red-600 hover:bg-red-700 text-white p-2 rounded-lg">
                    <i class="fas fa-sign-out-alt"></i>
                </button>
            </div>
        </header>
        
        <!-- Main Content -->
        <main class="flex-1 flex flex-col md:flex-row overflow-hidden">
            <!-- Sidebar Navigation -->
            <aside class="w-full md:w-60 bg-white dark:bg-gray-800 shadow-md md:h-full overflow-hidden">
                <nav class="flex md:flex-col p-2 md:p-4 space-x-2 md:space-x-0 md:space-y-2 overflow-x-auto md:overflow-x-visible">
                    <a href="#dashboard" class="sidebar-link active flex items-center space-x-2 px-4 py-3 rounded-lg bg-primary-100 dark:bg-primary-900 text-primary-700 dark:text-primary-300">
                        <i class="fas fa-chart-line"></i>
                        <span>Dashboard</span>
                    </a>
                    <a href="#colhedoras" class="sidebar-link flex items-center space-x-2 px-4 py-3 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700">
                        <i class="fas fa-tractor"></i>
                        <span>Colhedoras</span>
                    </a>
                    <a href="#producao" class="sidebar-link flex items-center space-x-2 px-4 py-3 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700">
                        <i class="fas fa-cube"></i>
                        <span>Registrar Produção</span>
                    </a>
                    <a href="#registros" class="sidebar-link flex items-center space-x-2 px-4 py-3 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700">
                        <i class="fas fa-list"></i>
                        <span>Histórico</span>
                    </a>
                    <a href="#caminhoes" class="sidebar-link flex items-center space-x-2 px-4 py-3 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700">
                        <i class="fas fa-truck"></i>
                        <span>Caminhões</span>
                    </a>
                    <a href="#configuracoes" class="sidebar-link flex items-center space-x-2 px-4 py-3 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700">
                        <i class="fas fa-cog"></i>
                        <span>Configurações</span>
                    </a>
                    <a href="#usuarios" class="sidebar-link admin-only flex items-center space-x-2 px-4 py-3 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700">
                        <i class="fas fa-users"></i>
                        <span>Usuários</span>
                    </a>
                </nav>
            </aside>
            
            <!-- Content Area -->
            <div class="flex-1 overflow-auto p-4">
                <!-- Dashboard Content -->
                <div id="content-dashboard" class="content fade-in">
                    <h2 class="text-2xl font-bold mb-4 text-gray-800 dark:text-gray-100 flex items-center">
                        <i class="fas fa-chart-line mr-3 text-primary-600 dark:text-primary-400"></i>
                        Dashboard
                    </h2>

                    <!-- Filtros de período -->
                    <div class="bg-white dark:bg-gray-800 rounded-lg shadow-md p-4 mb-6">
                        <div class="flex flex-col md:flex-row justify-between items-center space-y-2 md:space-y-0">
                            <h3 class="text-lg font-semibold text-gray-800 dark:text-white">
                                Visão Geral
                            </h3>
                            <div class="flex items-center space-x-2">
                                <label for="dashboard-period" class="text-sm text-gray-600 dark:text-gray-400">Período:</label>
                                <select id="dashboard-period" class="bg-gray-100 dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-md text-sm px-3 py-1">
                                    <option value="7">Últimos 7 dias</option>
                                    <option value="30" selected>Últimos 30 dias</option>
                                    <option value="90">Últimos 3 meses</option>
                                    <option value="180">Últimos 6 meses</option>
                                    <option value="365">Último ano</option>
                                </select>
                                <button id="refresh-dashboard" class="bg-primary-100 dark:bg-primary-900 text-primary-700 dark:text-primary-300 p-1 rounded hover:bg-primary-200 dark:hover:bg-primary-800">
                                    <i class="fas fa-sync-alt"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Cards de estatísticas principais -->
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-6">
                        <div class="bg-white dark:bg-gray-800 rounded-lg shadow-md p-5 card-hover">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-gray-500 dark:text-gray-400 text-sm font-medium">Total Colhido</p>
                                    <h3 id="dash-total-colhido" class="text-3xl font-bold text-gray-800 dark:text-white mt-1">0 T</h3>
                                </div>
                                <div class="bg-primary-100 dark:bg-primary-900 p-3 rounded-full">
                                    <i class="fas fa-weight-hanging text-xl text-primary-600 dark:text-primary-400"></i>
                                </div>
                            </div>
                            <div class="mt-3">
                                <div class="flex items-center">
                                    <span id="dash-total-trend" class="text-sm font-medium flex items-center">
                                        <i class="fas fa-arrow-up mr-1 text-green-500"></i>
                                        <span>0% vs. período anterior</span>
                                    </span>
                                </div>
                                <div class="w-full bg-gray-200 dark:bg-gray-700 rounded-full h-1.5 mt-2">
                                    <div id="dash-total-progress" class="bg-primary-600 h-1.5 rounded-full" style="width: 0%"></div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="bg-white dark:bg-gray-800 rounded-lg shadow-md p-5 card-hover">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-gray-500 dark:text-gray-400 text-sm font-medium">Área Total</p>
                                    <h3 id="dash-area-total" class="text-3xl font-bold text-gray-800 dark:text-white mt-1">0 ha</h3>
                                </div>
                                <div class="bg-secondary-100 dark:bg-secondary-900 p-3 rounded-full">
                                    <i class="fas fa-ruler-combined text-xl text-secondary-600 dark:text-secondary-400"></i>
                                </div>
                            </div>
                            <div class="mt-3">
                                <div class="flex items-center">
                                    <span id="dash-area-trend" class="text-sm font-medium flex items-center">
                                        <i class="fas fa-arrow-up mr-1 text-green-500"></i>
                                        <span>0% vs. período anterior</span>
                                    </span>
                                </div>
                                <div class="w-full bg-gray-200 dark:bg-gray-700 rounded-full h-1.5 mt-2">
                                    <div id="dash-area-progress" class="bg-secondary-600 h-1.5 rounded-full" style="width: 0%"></div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="bg-white dark:bg-gray-800 rounded-lg shadow-md p-5 card-hover">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-gray-500 dark:text-gray-400 text-sm font-medium">Produtividade Média</p>
                                    <h3 id="dash-produtividade" class="text-3xl font-bold text-gray-800 dark:text-white mt-1">0 T/ha</h3>
                                </div>
                                <div class="bg-accent-100 dark:bg-accent-900 p-3 rounded-full">
                                    <i class="fas fa-chart-line text-xl text-accent-600 dark:text-accent-400"></i>
                                </div>
                            </div>
                            <div class="mt-3">
                                <div class="flex items-center">
                                    <span id="dash-produtividade-trend" class="text-sm font-medium flex items-center">
                                        <i class="fas fa-arrow-up mr-1 text-green-500"></i>
                                        <span>0% vs. período anterior</span>
                                    </span>
                                </div>
                                <div class="w-full bg-gray-200 dark:bg-gray-700 rounded-full h-1.5 mt-2">
                                    <div id="dash-produtividade-progress" class="bg-accent-600 h-1.5 rounded-full" style="width: 0%"></div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="bg-white dark:bg-gray-800 rounded-lg shadow-md p-5 card-hover">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-gray-500 dark:text-gray-400 text-sm font-medium">Rendimento Médio</p>
                                    <h3 id="dash-rendimento" class="text-3xl font-bold text-gray-800 dark:text-white mt-1">0 T/h</h3>
                                </div>
                                <div class="bg-primary-100 dark:bg-primary-900 p-3 rounded-full">
                                    <i class="fas fa-clock text-xl text-primary-600 dark:text-primary-400"></i>
                                </div>
                            </div>
                            <div class="mt-3">
                                <div class="flex items-center">
                                    <span id="dash-rendimento-trend" class="text-sm font-medium flex items-center">
                                        <i class="fas fa-arrow-up mr-1 text-green-500"></i>
                                        <span>0% vs. período anterior</span>
                                    </span>
                                </div>
                                <div class="w-full bg-gray-200 dark:bg-gray-700 rounded-full h-1.5 mt-2">
                                    <div id="dash-rendimento-progress" class="bg-primary-600 h-1.5 rounded-full" style="width: 0%"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Gráficos principais -->
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">
                        <!-- Gráfico de produção ao longo do tempo -->
                        <div class="bg-white dark:bg-gray-800 rounded-lg shadow-md p-4">
                            <h3 class="text-lg font-semibold mb-3 text-gray-800 dark:text-white">
                                Produção ao Longo do Tempo
                            </h3>
                            <div class="h-64 w-full">
                                <canvas id="chart-producao-tempo"></canvas>
                            </div>
                        </div>
                        
                        <!-- Gráfico de distribuição por cultura -->
                        <div class="bg-white dark:bg-gray-800 rounded-lg shadow-md p-4">
                            <h3 class="text-lg font-semibold mb-3 text-gray-800 dark:text-white">
                                Distribuição por Cultura
                            </h3>
                            <div class="h-64 w-full">
                                <canvas id="chart-culturas"></canvas>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Seção de Desempenho -->
                    <div class="mb-6">
                        <div class="flex justify-between items-center mb-4">
                            <h3 class="text-lg font-semibold text-gray-800 dark:text-white">
                                <i class="fas fa-trophy mr-2 text-yellow-500"></i>
                                Análise de Desempenho
                            </h3>
                            <div class="flex items-center">
                                <button class="dashboard-tab tab-active px-3 py-1 text-sm" data-tab="colhedoras">Colhedoras</button>
                                <button class="dashboard-tab px-3 py-1 text-sm" data-tab="culturas">Culturas</button>
                            </div>
                        </div>
                        
                        <!-- Conteúdo de tabs -->
                        <div class="bg-white dark:bg-gray-800 rounded-lg shadow-md">
                            <!-- Tab de Colhedoras -->
                            <div id="tab-colhedoras" class="dashboard-tab-content p-4">
                                <div class="grid grid-cols-1 lg:grid-cols-3 gap-4">
                                    <!-- Melhor produtividade -->
                                    <div class="bg-gradient-to-r from-green-50 to-green-100 dark:from-green-900/30 dark:to-green-800/20 rounded-lg p-4">
                                        <div class="flex justify-between items-start">
                                            <div>
                                                <h4 class="text-sm font-medium text-green-800 dark:text-green-400">Melhor Produtividade</h4>
                                                <p id="best-productivity-colhedora" class="text-xl font-bold text-gray-800 dark:text-white mt-1">-</p>
                                                <p id="best-productivity-value" class="text-sm text-green-700 dark:text-green-400 font-medium">0 T/ha</p>
                                            </div>
                                            <div class="bg-green-200 dark:bg-green-700 p-2 rounded-full">
                                                <i class="fas fa-award text-green-600 dark:text-green-300"></i>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <!-- Maior volume -->
                                    <div class="bg-gradient-to-r from-blue-50 to-blue-100 dark:from-blue-900/30 dark:to-blue-800/20 rounded-lg p-4">
                                        <div class="flex justify-between items-start">
                                            <div>
                                                <h4 class="text-sm font-medium text-blue-800 dark:text-blue-400">Maior Volume</h4>
                                                <p id="best-volume-colhedora" class="text-xl font-bold text-gray-800 dark:text-white mt-1">-</p>
                                                <p id="best-volume-value" class="text-sm text-blue-700 dark:text-blue-400 font-medium">0 T</p>
                                            </div>
                                            <div class="bg-blue-200 dark:bg-blue-700 p-2 rounded-full">
                                                <i class="fas fa-weight-hanging text-blue-600 dark:text-blue-300"></i>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <!-- Melhor rendimento -->
                                    <div class="bg-gradient-to-r from-purple-50 to-purple-100 dark:from-purple-900/30 dark:to-purple-800/20 rounded-lg p-4">
                                        <div class="flex justify-between items-start">
                                            <div>
                                                <h4 class="text-sm font-medium text-purple-800 dark:text-purple-400">Melhor Rendimento</h4>
                                                <p id="best-yield-colhedora" class="text-xl font-bold text-gray-800 dark:text-white mt-1">-</p>
                                                <p id="best-yield-value" class="text-sm text-purple-700 dark:text-purple-400 font-medium">0 T/h</p>
                                            </div>
                                            <div class="bg-purple-200 dark:bg-purple-700 p-2 rounded-full">
                                                <i class="fas fa-bolt text-purple-600 dark:text-purple-300"></i>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Gráfico de comparação de colhedoras -->
                                <div class="mt-4 h-64">
                                    <canvas id="chart-colhedoras-comparacao"></canvas>
                                </div>
                            </div>
                            
                            <!-- Tab de Culturas -->
                            <div id="tab-culturas" class="dashboard-tab-content p-4 hidden">
                                <div class="grid grid-cols-1 lg:grid-cols-3 gap-4">
                                    <!-- Cultura mais produtiva -->
                                    <div class="bg-gradient-to-r from-green-50 to-green-100 dark:from-green-900/30 dark:to-green-800/20 rounded-lg p-4">
                                        <div class="flex justify-between items-start">
                                            <div>
                                                <h4 class="text-sm font-medium text-green-800 dark:text-green-400">Cultura Mais Produtiva</h4>
                                                <p id="best-productivity-cultura" class="text-xl font-bold text-gray-800 dark:text-white mt-1">-</p>
                                                <p id="best-productivity-cultura-value" class="text-sm text-green-700 dark:text-green-400 font-medium">0 T/ha</p>
                                            </div>
                                            <div class="bg-green-200 dark:bg-green-700 p-2 rounded-full">
                                                <i class="fas fa-seedling text-green-600 dark:text-green-300"></i>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <!-- Cultura com maior volume -->
                                    <div class="bg-gradient-to-r from-blue-50 to-blue-100 dark:from-blue-900/30 dark:to-blue-800/20 rounded-lg p-4">
                                        <div class="flex justify-between items-start">
                                            <div>
                                                <h4 class="text-sm font-medium text-blue-800 dark:text-blue-400">Maior Volume</h4>
                                                <p id="best-volume-cultura" class="text-xl font-bold text-gray-800 dark:text-white mt-1">-</p>
                                                <p id="best-volume-cultura-value" class="text-sm text-blue-700 dark:text-blue-400 font-medium">0 T</p>
                                            </div>
                                            <div class="bg-blue-200 dark:bg-blue-700 p-2 rounded-full">
                                                <i class="fas fa-weight-hanging text-blue-600 dark:text-blue-300"></i>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <!-- Cultura com maior área -->
                                    <div class="bg-gradient-to-r from-yellow-50 to-yellow-100 dark:from-yellow-900/30 dark:to-yellow-800/20 rounded-lg p-4">
                                        <div class="flex justify-between items-start">
                                            <div>
                                                <h4 class="text-sm font-medium text-yellow-800 dark:text-yellow-400">Maior Área</h4>
                                                <p id="best-area-cultura" class="text-xl font-bold text-gray-800 dark:text-white mt-1">-</p>
                                                <p id="best-area-cultura-value" class="text-sm text-yellow-700 dark:text-yellow-400 font-medium">0 ha</p>
                                            </div>
                                            <div class="bg-yellow-200 dark:bg-yellow-700 p-2 rounded-full">
                                                <i class="fas fa-ruler-combined text-yellow-600 dark:text-yellow-300"></i>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Gráfico de comparação de culturas -->
                                <div class="mt-4 h-64">
                                    <canvas id="chart-culturas-comparacao"></canvas>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Estatísticas de Caminhões -->
                    <div class="mb-6">
                        <h3 class="text-lg font-semibold mb-4 text-gray-800 dark:text-white">
                            <i class="fas fa-truck mr-2 text-primary-600 dark:text-primary-400"></i>
                            Estatísticas de Caminhões
                        </h3>
                        
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                            <div class="bg-white dark:bg-gray-800 rounded-lg shadow-md p-5 card-hover">
                                <div class="flex items-center justify-between">
                                    <div>
                                        <p class="text-gray-500 dark:text-gray-400 text-sm font-medium">Tempo Médio de Campo</p>
                                        <h3 id="dash-tempo-campo" class="text-3xl font-bold text-gray-800 dark:text-white mt-1">0 min</h3>
                                    </div>
                                    <div class="bg-green-100 dark:bg-green-900 p-3 rounded-full">
                                        <i class="fas fa-tractor text-xl text-green-600 dark:text-green-400"></i>
                                    </div>
                                </div>
                                <div class="w-full bg-gray-200 dark:bg-gray-700 rounded-full h-1.5 mt-3">
                                    <div id="dash-tempo-campo-progress" class="bg-green-600 h-1.5 rounded-full" style="width: 45%"></div>
                                </div>
                            </div>
                            
                            <div class="bg-white dark:bg-gray-800 rounded-lg shadow-md p-5 card-hover">
                                <div class="flex items-center justify-between">
                                    <div>
                                        <p class="text-gray-500 dark:text-gray-400 text-sm font-medium">Tempo Médio de Pátio</p>
                                        <h3 id="dash-tempo-patio" class="text-3xl font-bold text-gray-800 dark:text-white mt-1">0 min</h3>
                                    </div>
                                    <div class="bg-blue-100 dark:bg-blue-900 p-3 rounded-full">
                                        <i class="fas fa-warehouse text-xl text-blue-600 dark:text-blue-400"></i>
                                    </div>
                                </div>
                                <div class="w-full bg-gray-200 dark:bg-gray-700 rounded-full h-1.5 mt-3">
                                    <div id="dash-tempo-patio-progress" class="bg-blue-600 h-1.5 rounded-full" style="width: 30%"></div>
                                </div>
                            </div>
                            
                            <div class="bg-white dark:bg-gray-800 rounded-lg shadow-md p-5 card-hover">
                                <div class="flex items-center justify-between">
                                    <div>
                                        <p class="text-gray-500 dark:text-gray-400 text-sm font-medium">Registros de Caminhões</p>
                                        <h3 id="dash-total-caminhoes" class="text-3xl font-bold text-gray-800 dark:text-white mt-1">0</h3>
                                    </div>
                                    <div class="bg-yellow-100 dark:bg-yellow-900 p-3 rounded-full">
                                        <i class="fas fa-truck text-xl text-yellow-600 dark:text-yellow-400"></i>
                                    </div>
                                </div>
                                <div class="flex items-center mt-2">
                                    <span id="dash-caminhoes-trend" class="text-sm font-medium flex items-center">
                                        <i class="fas fa-arrow-up mr-1 text-green-500"></i>
                                        <span>0% vs. período anterior</span>
                                    </span>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Gráfico de tempos de caminhões -->
                        <div class="bg-white dark:bg-gray-800 rounded-lg shadow-md p-4 mt-4">
                            <h4 class="text-base font-semibold mb-3 text-gray-800 dark:text-white">
                                Análise de Tempos de Caminhões
                            </h4>
                            <div class="h-64">
                                <canvas id="chart-caminhoes-tempo"></canvas>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Resumo do Dashboard -->
                    <div class="bg-white dark:bg-gray-800 rounded-lg shadow-md p-6">
                        <h3 class="text-xl font-semibold mb-4 text-gray-800 dark:text-white flex items-center">
                            <i class="fas fa-info-circle mr-2 text-primary-600 dark:text-primary-400"></i>
                            Resumo da Atividade
                        </h3>
                        <p class="text-gray-600 dark:text-gray-400 mb-4">
                            Bem-vindo ao dashboard do GGOMES-LOG. Aqui você encontrará um resumo das atividades 
                            de produção e poderá acompanhar as principais métricas do sistema.
                        </p>
                        
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <h4 class="font-semibold text-gray-700 dark:text-gray-300 mb-2">Colhedoras Registradas</h4>
                                <div class="flex items-end">
                                    <p id="qtd-colhedoras" class="text-2xl font-bold text-primary-700 dark:text-primary-300">0</p>
                                    <p class="text-sm text-gray-500 dark:text-gray-400 ml-2 mb-1">unidades</p>
                                </div>
                            </div>
                            <div>
                                <h4 class="font-semibold text-gray-700 dark:text-gray-300 mb-2">Registros de Produção</h4>
                                <div class="flex items-end">
                                    <p id="qtd-registros" class="text-2xl font-bold text-secondary-700 dark:text-secondary-300">0</p>
                                    <p class="text-sm text-gray-500 dark:text-gray-400 ml-2 mb-1">registros</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Colhedoras Content -->
                <div id="content-colhedoras" class="content hidden fade-in">
                    <h2 class="text-2xl font-bold mb-6 text-gray-800 dark:text-gray-100 flex items-center">
                        <i class="fas fa-tractor mr-3 text-primary-600 dark:text-primary-400"></i>
                        Gerenciar Colhedoras
                    </h2>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <!-- Formulário para adicionar colhedora -->
                        <div class="bg-white dark:bg-gray-800 rounded-lg shadow-md p-6">
                            <h3 class="text-xl font-semibold mb-4 text-gray-800 dark:text-white flex items-center">
                                <i class="fas fa-plus-circle mr-2 text-primary-600 dark:text-primary-400"></i>
                                Adicionar Nova Colhedora
                            </h3>
                            <form id="form-colhedora" class="space-y-4">
                                <div>
                                    <label for="id-colhedora" class="block mb-1 text-gray-700 dark:text-gray-300">Identificação/Número</label>
                                    <div class="relative">
                                        <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                                            <i class="fas fa-hashtag text-gray-400"></i>
                                        </div>
                                        <input type="text" id="id-colhedora" class="w-full pl-10 pr-4 py-2 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-800 dark:text-white text-base focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-transparent" placeholder="Ex: Colhedora 001" required>
                                    </div>
                                </div>
                                <div>
                                    <label for="modelo-colhedora" class="block mb-1 text-gray-700 dark:text-gray-300">Modelo</label>
                                    <div class="relative">
                                        <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                                            <i class="fas fa-tractor text-gray-400"></i>
                                        </div>
                                        <input type="text" id="modelo-colhedora" class="w-full pl-10 pr-4 py-2 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-800 dark:text-white text-base focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-transparent" placeholder="Ex: JD 9670" required>
                                    </div>
                                </div>
                                <div>
                                    <label for="ano-colhedora" class="block mb-1 text-gray-700 dark:text-gray-300">Ano de Fabricação</label>
                                    <div class="relative">
                                        <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                                            <i class="fas fa-calendar text-gray-400"></i>
                                        </div>
                                        <input type="number" id="ano-colhedora" class="w-full pl-10 pr-4 py-2 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-800 dark:text-white text-base focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-transparent" placeholder="Ex: 2022" min="1900" max="2100">
                                    </div>
                                </div>
                                <div>
                                    <label for="potencia-colhedora" class="block mb-1 text-gray-700 dark:text-gray-300">Potência (cv)</label>
                                    <div class="relative">
                                        <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                                            <i class="fas fa-bolt text-gray-400"></i>
                                        </div>
                                        <input type="number" id="potencia-colhedora" class="w-full pl-10 pr-4 py-2 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-800 dark:text-white text-base focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-transparent" placeholder="Ex: 300" min="0">
                                    </div>
                                </div>
                                <button type="submit" class="w-full bg-primary-600 hover:bg-primary-700 text-white px-4 py-2 rounded-lg transition duration-200 flex items-center justify-center admin-only">
                                    <i class="fas fa-plus-circle mr-2"></i>
                                    Adicionar Colhedora
                                </button>
                            </form>
                        </div>
                        
                        <!-- Lista de colhedoras -->
                        <div class="bg-white dark:bg-gray-800 rounded-lg shadow-md p-6">
                            <h3 class="text-xl font-semibold mb-4 text-gray-800 dark:text-white flex items-center">
                                <i class="fas fa-list-ul mr-2 text-primary-600 dark:text-primary-400"></i>
                                Colhedoras Cadastradas
                            </h3>
                            <div class="overflow-y-auto max-h-[400px]" id="lista-colhedoras-container">
                                <div class="text-gray-500 dark:text-gray-400 text-center py-10">
                                    <i class="fas fa-tractor text-5xl mb-3 text-gray-300 dark:text-gray-600"></i>
                                    <p>Nenhuma colhedora cadastrada</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Producao Content -->
                <div id="content-producao" class="content hidden fade-in">
                    <h2 class="text-2xl font-bold mb-6 text-gray-800 dark:text-gray-100 flex items-center">
                        <i class="fas fa-cube mr-3 text-primary-600 dark:text-primary-400"></i>
                        Registrar Produção
                    </h2>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <!-- Formulário para registrar produção -->
                        <div class="bg-white dark:bg-gray-800 rounded-lg shadow-md p-6">
                            <h3 class="text-xl font-semibold mb-4 text-gray-800 dark:text-white flex items-center">
                                <i class="fas fa-edit mr-2 text-primary-600 dark:text-primary-400"></i>
                                Novo Registro de Produção
                            </h3>
                            <form id="form-producao" class="space-y-4">
                                <div>
                                    <label for="colhedora-select" class="block mb-1 text-gray-700 dark:text-gray-300">Selecione a Colhedora</label>
                                    <div class="relative">
                                        <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                                            <i class="fas fa-tractor text-gray-400"></i>
                                        </div>
                                        <select id="colhedora-select" class="w-full pl-10 pr-4 py-2 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-800 dark:text-white text-base focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-transparent" required>
                                            <option value="">Selecione uma colhedora...</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                    <div>
                                        <label for="data-producao" class="block mb-1 text-gray-700 dark:text-gray-300">Data</label>
                                        <div class="relative">
                                            <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                                                <i class="fas fa-calendar text-gray-400"></i>
                                            </div>
                                            <input type="date" id="data-producao" class="w-full pl-10 pr-4 py-2 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-800 dark:text-white text-base focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-transparent" required>
                                        </div>
                                    </div>
                                    <div>
                                        <label for="cultura-producao" class="block mb-1 text-gray-700 dark:text-gray-300">Cultura</label>
                                        <div class="relative">
                                            <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                                                <i class="fas fa-seedling text-gray-400"></i>
                                            </div>
                                            <select id="cultura-producao" class="w-full pl-10 pr-4 py-2 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-800 dark:text-white text-base focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-transparent">
                                                <option value="">Selecione...</option>
                                                <option value="Soja">Soja</option>
                                                <option value="Milho">Milho</option>
                                                <option value="Trigo">Trigo</option>
                                                <option value="Arroz">Arroz</option>
                                                <option value="Algodão">Algodão</option>
                                                <option value="Feijão">Feijão</option>
                                                <option value="Cana">Cana-de-açúcar</option>
                                                <option value="Outro">Outro</option>
                                            </select>
                                        </div>
                                    </div>
                                </div>
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                    <div>
                                        <label for="qtd-colhida" class="block mb-1 text-gray-700 dark:text-gray-300">Quantidade Colhida (T)</label>
                                        <div class="relative">
                                            <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                                                <i class="fas fa-weight-hanging text-gray-400"></i>
                                            </div>
                                            <input type="number" id="qtd-colhida" class="w-full pl-10 pr-4 py-2 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-800 dark:text-white text-base focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-transparent" placeholder="Ex: 5000" min="0" required>
                                        </div>
                                    </div>
                                    <div>
                                        <label for="area-colhida" class="block mb-1 text-gray-700 dark:text-gray-300">Área Colhida (hectares)</label>
                                        <div class="relative">
                                            <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                                                <i class="fas fa-ruler-combined text-gray-400"></i>
                                            </div>
                                            <input type="number" id="area-colhida" class="w-full pl-10 pr-4 py-2 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-800 dark:text-white text-base focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-transparent" placeholder="Ex: 10" step="0.01" min="0" required>
                                        </div>
                                    </div>
                                </div>
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                    <div>
                                        <label for="horas-trabalhadas" class="block mb-1 text-gray-700 dark:text-gray-300">Horas Trabalhadas</label>
                                        <div class="relative">
                                            <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                                                <i class="fas fa-clock text-gray-400"></i>
                                            </div>
                                            <input type="number" id="horas-trabalhadas" class="w-full pl-10 pr-4 py-2 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-800 dark:text-white text-base focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-transparent" placeholder="Ex: 8" step="0.5" min="0" required>
                                        </div>
                                    </div>
                                    <div>
                                        <label for="combustivel" class="block mb-1 text-gray-700 dark:text-gray-300">Combustível (litros)</label>
                                        <div class="relative">
                                            <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                                                <i class="fas fa-gas-pump text-gray-400"></i>
                                            </div>
                                            <input type="number" id="combustivel" class="w-full pl-10 pr-4 py-2 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-800 dark:text-white text-base focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-transparent" placeholder="Ex: 150" step="0.1" min="0">
                                        </div>
                                    </div>
                                </div>
                                <div>
                                    <label for="observacoes" class="block mb-1 text-gray-700 dark:text-gray-300">Observações</label>
                                    <div class="relative">
                                        <div class="absolute top-3 left-3 flex items-start pointer-events-none">
                                            <i class="fas fa-comment text-gray-400"></i>
                                        </div>
                                        <textarea id="observacoes" rows="3" class="w-full pl-10 pr-4 py-2 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-800 dark:text-white text-base focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-transparent" placeholder="Observações adicionais..."></textarea>
                                    </div>
                                </div>
                                <button type="submit" class="w-full bg-primary-600 hover:bg-primary-700 text-white px-4 py-2 rounded-lg transition duration-200 flex items-center justify-center admin-only">
                                    <i class="fas fa-save mr-2"></i>
                                    Registrar Produção
                                </button>
                            </form>
                        </div>
                        
                        <!-- Resumo e Estatísticas -->
                        <div class="bg-white dark:bg-gray-800 rounded-lg shadow-md p-6">
                            <h3 class="text-xl font-semibold mb-4 text-gray-800 dark:text-white flex items-center">
                                <i class="fas fa-chart-pie mr-2 text-primary-600 dark:text-primary-400"></i>
                                Resumo de Produção
                            </h3>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
                                <div class="bg-gray-50 dark:bg-gray-700 rounded-lg p-4">
                                    <p class="text-gray-500 dark:text-gray-400 text-sm">Total Colhido</p>
                                    <p id="total-colhido" class="text-2xl font-bold text-primary-700 dark:text-primary-300">0 T</p>
                                </div>
                                <div class="bg-gray-50 dark:bg-gray-700 rounded-lg p-4">
                                    <p class="text-gray-500 dark:text-gray-400 text-sm">Área Total</p>
                                    <p id="area-total" class="text-2xl font-bold text-secondary-700 dark:text-secondary-300">0 ha</p>
                                </div>
                                <div class="bg-gray-50 dark:bg-gray-700 rounded-lg p-4">
                                    <p class="text-gray-500 dark:text-gray-400 text-sm">Produtividade Média</p>
                                    <p id="produtividade-media" class="text-2xl font-bold text-accent-700 dark:text-accent-300">0 T/ha</p>
                                </div>
                                <div class="bg-gray-50 dark:bg-gray-700 rounded-lg p-4">
                                    <p class="text-gray-500 dark:text-gray-400 text-sm">Rendimento Médio</p>
                                    <p id="rendimento-medio" class="text-2xl font-bold text-primary-700 dark:text-primary-300">0 T/h</p>
                                </div>
                            </div>
                            
                            <h4 class="font-semibold text-gray-700 dark:text-gray-300 mb-3">Produção por Colhedora</h4>
                            <div class="overflow-y-auto max-h-[250px]">
                                <table class="min-w-full divide-y divide-gray-200 dark:divide-gray-700">
                                    <thead class="bg-gray-50 dark:bg-gray-700">
                                        <tr>
                                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Colhedora</th>
                                            <th class="px-4 py-3 text-right text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Total (T)</th>
                                            <th class="px-4 py-3 text-right text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Área (ha)</th>
                                            <th class="px-4 py-3 text-right text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Prod. (T/ha)</th>
                                        </tr>
                                    </thead>
                                    <tbody id="tabela-colhedoras" class="divide-y divide-gray-200 dark:divide-gray-700">
                                        <tr>
                                            <td colspan="4" class="px-4 py-4 text-center text-gray-500 dark:text-gray-400">Nenhuma colhedora registrada</td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Registros Content -->
                <div id="content-registros" class="content hidden fade-in">
                    <h2 class="text-2xl font-bold mb-6 text-gray-800 dark:text-gray-100 flex items-center">
                        <i class="fas fa-list mr-3 text-primary-600 dark:text-primary-400"></i>
                        Histórico de Produção
                    </h2>
                    
                    <!-- Filtros de pesquisa -->
                    <div class="bg-white dark:bg-gray-800 rounded-lg shadow-md p-6 mb-6">
                        <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                            <div>
                                <label for="filtro-colhedora" class="block mb-1 text-gray-700 dark:text-gray-300 text-sm">Colhedora</label>
                                <select id="filtro-colhedora" class="w-full px-4 py-2 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-800 dark:text-white text-base focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-transparent">
                                    <option value="">Todas</option>
                                </select>
                            </div>
                            <div>
                                <label for="filtro-cultura" class="block mb-1 text-gray-700 dark:text-gray-300 text-sm">Cultura</label>
                                <select id="filtro-cultura" class="w-full px-4 py-2 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-800 dark:text-white text-base focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-transparent">
                                    <option value="">Todas</option>
                                </select>
                            </div>
                            <div>
                                <label for="filtro-data-inicio" class="block mb-1 text-gray-700 dark:text-gray-300 text-sm">Data Inicial</label>
                                <input type="date" id="filtro-data-inicio" class="w-full px-4 py-2 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-800 dark:text-white text-base focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-transparent">
                            </div>
                            <div>
                                <label for="filtro-data-fim" class="block mb-1 text-gray-700 dark:text-gray-300 text-sm">Data Final</label>
                                <input type="date" id="filtro-data-fim" class="w-full px-4 py-2 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-800 dark:text-white text-base focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-transparent">
                            </div>
                        </div>
                        <div class="mt-4 flex justify-end">
                            <button id="btn-limpar-filtros" class="bg-gray-200 hover:bg-gray-300 dark:bg-gray-700 dark:hover:bg-gray-600 text-gray-700 dark:text-gray-300 px-4 py-2 rounded-lg mr-2">
                                <i class="fas fa-times-circle mr-1"></i> Limpar
                            </button>
                            <button id="btn-aplicar-filtros" class="bg-primary-600 hover:bg-primary-700 text-white px-4 py-2 rounded-lg">
                                <i class="fas fa-filter mr-1"></i> Filtrar
                            </button>
                        </div>
                    </div>
                    
                    <!-- Tabela de registros -->
                    <div class="bg-white dark:bg-gray-800 rounded-lg shadow-md">
                        <div class="p-4 border-b border-gray-200 dark:border-gray-700 flex justify-between items-center">
                            <h3 class="font-semibold text-gray-800 dark:text-white">Registros de Produção</h3>
                            <div>
                                <button id="btn-exportar" class="text-primary-600 hover:text-primary-800 dark:text-primary-400 dark:hover:text-primary-300">
                                    <i class="fas fa-file-export mr-1"></i> Exportar
                                </button>
                            </div>
                        </div>
                        <div class="overflow-x-auto">
                            <table class="min-w-full divide-y divide-gray-200 dark:divide-gray-700">
                                <thead class="bg-gray-50 dark:bg-gray-700">
                                    <tr>
                                        <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Data</th>
                                        <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Colhedora</th>
                                        <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Cultura</th>
                                        <th class="px-4 py-3 text-right text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Qtd. (T)</th>
                                        <th class="px-4 py-3 text-right text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Área (ha)</th>
                                        <th class="px-4 py-3 text-right text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Horas</th>
                                        <th class="px-4 py-3 text-right text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Prod. (T/ha)</th>
                                        <th class="px-4 py-3 text-right text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Rend. (T/h)</th>
                                        <th class="px-4 py-3 text-center text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider admin-only">Ações</th>
                                    </tr>
                                </thead>
                                <tbody id="tabela-registros" class="divide-y divide-gray-200 dark:divide-gray-700">
                                    <tr>
                                        <td colspan="9" class="px-4 py-4 text-center text-gray-500 dark:text-gray-400">Nenhum registro encontrado</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                        <div class="p-4 border-t border-gray-200 dark:border-gray-700 flex justify-between items-center">
                            <div class="text-sm text-gray-500 dark:text-gray-400">
                                <span id="registros-contagem">0</span> registros encontrados
                            </div>
                            <div class="flex space-x-2">
                                <button id="btn-pagina-anterior" class="bg-gray-200 hover:bg-gray-300 dark:bg-gray-700 dark:hover:bg-gray-600 text-gray-700 dark:text-gray-300 px-3 py-1 rounded" disabled>
                                    <i class="fas fa-chevron-left"></i>
                                </button>
                                <span id="paginacao-info" class="px-3 py-1 text-gray-600 dark:text-gray-300">Página 1</span>
                                <button id="btn-proxima-pagina" class="bg-gray-200 hover:bg-gray-300 dark:bg-gray-700 dark:hover:bg-gray-600 text-gray-700 dark:text-gray-300 px-3 py-1 rounded" disabled>
                                    <i class="fas fa-chevron-right"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Caminhões Content -->
                <div id="content-caminhoes" class="content hidden fade-in">
                    <h2 class="text-2xl font-bold mb-6 text-gray-800 dark:text-gray-100 flex items-center">
                        <i class="fas fa-truck mr-3 text-primary-600 dark:text-primary-400"></i>
                        Tempo de Caminhões
                    </h2>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <!-- Formulário para registrar tempos de caminhões -->
                        <div class="bg-white dark:bg-gray-800 rounded-lg shadow-md p-6">
                            <h3 class="text-xl font-semibold mb-4 text-gray-800 dark:text-white flex items-center">
                                <i class="fas fa-stopwatch mr-2 text-primary-600 dark:text-primary-400"></i>
                                Registrar Tempo de Caminhão
                            </h3>
                            <form id="form-caminhao" class="space-y-4">
                                <div>
                                    <label for="id-caminhao" class="block mb-1 text-gray-700 dark:text-gray-300">Identificação do Caminhão</label>
                                    <div class="relative">
                                        <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                                            <i class="fas fa-truck text-gray-400"></i>
                                        </div>
                                        <input type="text" id="id-caminhao" class="w-full pl-10 pr-4 py-2 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-800 dark:text-white text-base focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-transparent" placeholder="Ex: Caminhão 001" required>
                                    </div>
                                </div>
                                <div>
                                    <label for="data-caminhao" class="block mb-1 text-gray-700 dark:text-gray-300">Data</label>
                                    <div class="relative">
                                        <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                                            <i class="fas fa-calendar text-gray-400"></i>
                                        </div>
                                        <input type="date" id="data-caminhao" class="w-full pl-10 pr-4 py-2 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-800 dark:text-white text-base focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-transparent" required>
                                    </div>
                                </div>
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                    <div>
                                        <label for="tempo-campo" class="block mb-1 text-gray-700 dark:text-gray-300">Tempo de Campo (minutos)</label>
                                        <div class="relative">
                                            <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                                                <i class="fas fa-tractor text-gray-400"></i>
                                            </div>
                                            <input type="number" id="tempo-campo" class="w-full pl-10 pr-4 py-2 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-800 dark:text-white text-base focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-transparent" placeholder="Ex: 120" min="0" required>
                                        </div>
                                    </div>
                                    <div>
                                        <label for="tempo-patio" class="block mb-1 text-gray-700 dark:text-gray-300">Tempo de Pátio (minutos)</label>
                                        <div class="relative">
                                            <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                                                <i class="fas fa-warehouse text-gray-400"></i>
                                            </div>
                                            <input type="number" id="tempo-patio" class="w-full pl-10 pr-4 py-2 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-800 dark:text-white text-base focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-transparent" placeholder="Ex: 45" min="0" required>
                                        </div>
                                    </div>
                                </div>
                                <div>
                                    <label for="observacoes-caminhao" class="block mb-1 text-gray-700 dark:text-gray-300">Observações</label>
                                    <div class="relative">
                                        <div class="absolute top-3 left-3 flex items-start pointer-events-none">
                                            <i class="fas fa-comment text-gray-400"></i>
                                        </div>
                                        <textarea id="observacoes-caminhao" rows="2" class="w-full pl-10 pr-4 py-2 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-800 dark:text-white text-base focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-transparent" placeholder="Observações adicionais..."></textarea>
                                    </div>
                                </div>
                                <button type="submit" class="w-full bg-primary-600 hover:bg-primary-700 text-white px-4 py-2 rounded-lg transition duration-200 flex items-center justify-center admin-only">
                                    <i class="fas fa-save mr-2"></i>
                                    Registrar Tempo
                                </button>
                            </form>
                        </div>
                        
                        <!-- Resumo e médias -->
                        <div class="bg-white dark:bg-gray-800 rounded-lg shadow-md p-6">
                            <h3 class="text-xl font-semibold mb-4 text-gray-800 dark:text-white flex items-center">
                                <i class="fas fa-chart-bar mr-2 text-primary-600 dark:text-primary-400"></i>
                                Resumo de Tempos
                            </h3>
                            
                            <!-- Cards para médias -->
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
                                <div class="bg-gray-50 dark:bg-gray-700 rounded-lg p-4">
                                    <p class="text-gray-500 dark:text-gray-400 text-sm">Média Diária - Campo</p>
                                    <p id="media-campo" class="text-2xl font-bold text-primary-700 dark:text-primary-300">0 min</p>
                                </div>
                                <div class="bg-gray-50 dark:bg-gray-700 rounded-lg p-4">
                                    <p class="text-gray-500 dark:text-gray-400 text-sm">Média Diária - Pátio</p>
                                    <p id="media-patio" class="text-2xl font-bold text-accent-700 dark:text-accent-300">0 min</p>
                                </div>
                                <div class="bg-gray-50 dark:bg-gray-700 rounded-lg p-4">
                                    <p class="text-gray-500 dark:text-gray-400 text-sm">Total de Registros</p>
                                    <p id="total-registros-caminhoes" class="text-2xl font-bold text-secondary-700 dark:text-secondary-300">0</p>
                                </div>
                                <div class="bg-gray-50 dark:bg-gray-700 rounded-lg p-4">
                                    <p class="text-gray-500 dark:text-gray-400 text-sm">Tempo Médio Total</p>
                                    <p id="tempo-total-medio" class="text-2xl font-bold text-primary-700 dark:text-primary-300">0 min</p>
                                </div>
                            </div>
                            
                            <!-- Filtro por data para médias -->
                            <div class="mb-4">
                                <label for="data-filtro-caminhoes" class="block mb-1 text-gray-700 dark:text-gray-300 text-sm">Filtrar por data</label>
                                <div class="relative">
                                    <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                                        <i class="fas fa-calendar text-gray-400"></i>
                                    </div>
                                    <input type="date" id="data-filtro-caminhoes" class="w-full pl-10 pr-4 py-2 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-800 dark:text-white text-base focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-transparent">
                                </div>
                            </div>
                            
                            <!-- Tabela de média por caminhão -->
                            <h4 class="font-semibold text-gray-700 dark:text-gray-300 mb-3">Médias por Caminhão</h4>
                            <div class="overflow-y-auto max-h-[200px]">
                                <table class="min-w-full divide-y divide-gray-200 dark:divide-gray-700">
                                    <thead class="bg-gray-50 dark:bg-gray-700">
                                        <tr>
                                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Caminhão</th>
                                            <th class="px-4 py-3 text-right text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Tempo Campo (min)</th>
                                            <th class="px-4 py-3 text-right text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Tempo Pátio (min)</th>
                                            <th class="px-4 py-3 text-right text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Total (min)</th>
                                        </tr>
                                    </thead>
                                    <tbody id="tabela-medias-caminhoes" class="divide-y divide-gray-200 dark:divide-gray-700">
                                        <tr>
                                            <td colspan="4" class="px-4 py-4 text-center text-gray-500 dark:text-gray-400">Nenhum registro de caminhão</td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Histórico de registros -->
                    <div class="mt-6 bg-white dark:bg-gray-800 rounded-lg shadow-md p-6">
                        <h3 class="text-xl font-semibold mb-4 text-gray-800 dark:text-white flex items-center">
                            <i class="fas fa-history mr-2 text-primary-600 dark:text-primary-400"></i>
                            Histórico de Tempos
                        </h3>
                        
                        <div class="overflow-x-auto">
                            <table class="min-w-full divide-y divide-gray-200 dark:divide-gray-700">
                                <thead class="bg-gray-50 dark:bg-gray-700">
                                    <tr>
                                        <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Data</th>
                                        <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Caminhão</th>
                                        <th class="px-4 py-3 text-right text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Tempo Campo (min)</th>
                                        <th class="px-4 py-3 text-right text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Tempo Pátio (min)</th>
                                        <th class="px-4 py-3 text-right text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Tempo Total (min)</th>
                                        <th class="px-4 py-3 text-center text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider admin-only">Ações</th>
                                    </tr>
                                </thead>
                                <tbody id="tabela-historico-caminhoes" class="divide-y divide-gray-200 dark:divide-gray-700">
                                    <tr>
                                        <td colspan="6" class="px-4 py-4 text-center text-gray-500 dark:text-gray-400">Nenhum registro encontrado</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
                
                <!-- Configurações Content -->
                <div id="content-configuracoes" class="content hidden fade-in">
                    <h2 class="text-2xl font-bold mb-6 text-gray-800 dark:text-gray-100 flex items-center">
                        <i class="fas fa-cog mr-3 text-primary-600 dark:text-primary-400"></i>
                        Configurações
                    </h2>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <!-- Configurações Gerais -->
                        <div class="bg-white dark:bg-gray-800 rounded-lg shadow-md p-6">
                            <h3 class="text-xl font-semibold mb-4 text-gray-800 dark:text-white flex items-center">
                                <i class="fas fa-sliders-h mr-2 text-primary-600 dark:text-primary-400"></i>
                                Configurações Gerais
                            </h3>
                            <div class="space-y-6">
                                <div>
                                    <label class="flex items-center justify-between cursor-pointer">
                                        <span class="text-gray-700 dark:text-gray-300">Modo Escuro</span>
                                        <div class="relative">
                                            <input id="toggle-theme-switch" type="checkbox" class="sr-only">
                                            <div class="w-12 h-6 bg-gray-200 dark:bg-gray-700 rounded-full"></div>
                                            <div class="dot absolute left-1 top-1 bg-white w-4 h-4 rounded-full transition dark:transform dark:translate-x-6"></div>
                                        </div>
                                    </label>
                                </div>
                                <div>
                                    <label for="registros-por-pagina" class="block mb-1 text-gray-700 dark:text-gray-300">Registros por página</label>
                                    <select id="registros-por-pagina" class="w-full px-4 py-2 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-800 dark:text-white text-base focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-transparent">
                                        <option value="10">10</option>
                                        <option value="25">25</option>
                                        <option value="50">50</option>
                                        <option value="100">100</option>
                                    </select>
                                </div>
                                <div>
                                    <label for="formato-data" class="block mb-1 text-gray-700 dark:text-gray-300">Formato de data</label>
                                    <select id="formato-data" class="w-full px-4 py-2 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-800 dark:text-white text-base focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-transparent">
                                        <option value="dd/MM/yyyy">DD/MM/YYYY</option>
                                        <option value="MM/dd/yyyy">MM/DD/YYYY</option>
                                        <option value="yyyy-MM-dd">YYYY-MM-DD</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Informações do Usuário -->
                        <div class="bg-white dark:bg-gray-800 rounded-lg shadow-md p-6">
                            <h3 class="text-xl font-semibold mb-4 text-gray-800 dark:text-white flex items-center">
                                <i class="fas fa-user-cog mr-2 text-primary-600 dark:text-primary-400"></i>
                                Informações do Usuário
                            </h3>
                            <div class="space-y-4">
                                <div>
                                    <p class="text-gray-700 dark:text-gray-300">Nome:</p>
                                    <p id="user-info-name" class="font-semibold text-gray-800 dark:text-white">-</p>
                                </div>
                                <div>
                                    <p class="text-gray-700 dark:text-gray-300">Email:</p>
                                    <p id="user-info-email" class="font-semibold text-gray-800 dark:text-white">-</p>
                                </div>
                                <div>
                                    <p class="text-gray-700 dark:text-gray-300">Função:</p>
                                    <p id="user-info-role" class="font-semibold text-gray-800 dark:text-white">-</p>
                                </div>
                                <div class="pt-4">
                                    <button id="btn-logout-config" class="w-full bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded-lg transition duration-200 flex items-center justify-center">
                                        <i class="fas fa-sign-out-alt mr-2"></i>
                                        Sair da Conta
                                    </button>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Backup e Importação/Exportação -->
                        <div class="bg-white dark:bg-gray-800 rounded-lg shadow-md p-6">
                            <h3 class="text-xl font-semibold mb-4 text-gray-800 dark:text-white flex items-center">
                                <i class="fas fa-database mr-2 text-primary-600 dark:text-primary-400"></i>
                                Backup e Compartilhamento
                            </h3>
                            <div class="space-y-4">
                                <div>
                                    <p class="text-gray-600 dark:text-gray-400 mb-2">Exportar todos os dados para compartilhar entre dispositivos.</p>
                                    <button id="btn-backup" class="w-full bg-primary-600 hover:bg-primary-700 text-white px-4 py-2 rounded-lg transition duration-200 flex items-center justify-center">
                                        <i class="fas fa-download mr-2"></i>
                                        Exportar Dados
                                    </button>
                                </div>
                                
                                <div>
                                    <p class="text-gray-600 dark:text-gray-400 mb-2">Importar dados de outro dispositivo.</p>
                                    <label for="input-import" class="w-full bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg transition duration-200 flex items-center justify-center cursor-pointer">
                                        <i class="fas fa-upload mr-2"></i>
                                        Importar Dados
                                    </label>
                                    <input type="file" id="input-import" accept=".json" class="hidden">
                                </div>
                                
                                <div class="pt-2 pb-2 border-t border-gray-200 dark:border-gray-700">
                                    <p class="text-gray-600 dark:text-gray-400 text-sm mt-2 mb-2">
                                        <i class="fas fa-info-circle mr-1"></i>
                                        A importação substituirá todos os dados atuais. Recomendamos exportar seus dados atuais antes de importar novos.
                                    </p>
                                </div>
                                
                                <div class="pt-2 admin-only">
                                    <p class="text-gray-600 dark:text-gray-400 mb-2">Limpar todos os dados do sistema (não recuperável).</p>
                                    <button id="btn-limpar-dados" class="w-full bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded-lg transition duration-200 flex items-center justify-center">
                                        <i class="fas fa-trash-alt mr-2"></i>
                                        Limpar Todos os Dados
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Usuários Content (apenas para administradores) -->
                <div id="content-usuarios" class="content hidden fade-in">
                    <h2 class="text-2xl font-bold mb-6 text-gray-800 dark:text-gray-100 flex items-center">
                        <i class="fas fa-users mr-3 text-primary-600 dark:text-primary-400"></i>
                        Gerenciar Usuários
                    </h2>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <!-- Formulário para adicionar usuário -->
                        <div class="bg-white dark:bg-gray-800 rounded-lg shadow-md p-6">
                            <h3 class="text-xl font-semibold mb-4 text-gray-800 dark:text-white flex items-center">
                                <i class="fas fa-user-plus mr-2 text-primary-600 dark:text-primary-400"></i>
                                Adicionar Novo Usuário
                            </h3>
                            <form id="form-usuario" class="space-y-4">
                                <div>
                                    <label for="nome-usuario" class="block mb-1 text-gray-700 dark:text-gray-300">Nome Completo</label>
                                    <div class="relative">
                                        <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                                            <i class="fas fa-user text-gray-400"></i>
                                        </div>
                                        <input type="text" id="nome-usuario" class="w-full pl-10 pr-4 py-2 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-800 dark:text-white text-base focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-transparent" placeholder="Ex: João Silva" required>
                                    </div>
                                </div>
                                <div>
                                    <label for="email-usuario" class="block mb-1 text-gray-700 dark:text-gray-300">Email</label>
                                    <div class="relative">
                                        <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                                            <i class="fas fa-envelope text-gray-400"></i>
                                        </div>
                                        <input type="email" id="email-usuario" class="w-full pl-10 pr-4 py-2 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-800 dark:text-white text-base focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-transparent" placeholder="Ex: joao@exemplo.com" required>
                                    </div>
                                </div>
                                <div>
                                    <label for="senha-usuario" class="block mb-1 text-gray-700 dark:text-gray-300">Senha</label>
                                    <div class="relative">
                                        <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                                            <i class="fas fa-lock text-gray-400"></i>
                                        </div>
                                        <input type="password" id="senha-usuario" class="w-full pl-10 pr-4 py-2 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-800 dark:text-white text-base focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-transparent" placeholder="Mínimo 6 caracteres" required>
                                    </div>
                                </div>
                                <div>
                                    <label class="block mb-1 text-gray-700 dark:text-gray-300">Perfil</label>
                                    <div class="flex space-x-4">
                                        <label class="inline-flex items-center">
                                            <input type="radio" name="tipo-usuario" value="usuario" class="text-primary-600 focus:ring-primary-500" checked>
                                            <span class="ml-2">Usuário</span>
                                        </label>
                                        <label class="inline-flex items-center">
                                            <input type="radio" name="tipo-usuario" value="admin" class="text-primary-600 focus:ring-primary-500">
                                            <span class="ml-2">Administrador</span>
                                        </label>
                                    </div>
                                </div>
                                <button type="submit" class="w-full bg-primary-600 hover:bg-primary-700 text-white px-4 py-2 rounded-lg transition duration-200 flex items-center justify-center">
                                    <i class="fas fa-user-plus mr-2"></i>
                                    Adicionar Usuário
                                </button>
                            </form>
                        </div>
                        
                        <!-- Lista de usuários -->
                        <div class="bg-white dark:bg-gray-800 rounded-lg shadow-md p-6">
                            <h3 class="text-xl font-semibold mb-4 text-gray-800 dark:text-white flex items-center">
                                <i class="fas fa-user-friends mr-2 text-primary-600 dark:text-primary-400"></i>
                                Usuários Cadastrados
                            </h3>
                            <div class="overflow-y-auto max-h-[400px]">
                                <table class="min-w-full divide-y divide-gray-200 dark:divide-gray-700">
                                    <thead class="bg-gray-50 dark:bg-gray-700">
                                        <tr>
                                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Nome</th>
                                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Email</th>
                                            <th class="px-4 py-3 text-center text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Perfil</th>
                                            <th class="px-4 py-3 text-center text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Ações</th>
                                        </tr>
                                    </thead>
                                    <tbody id="tabela-usuarios" class="divide-y divide-gray-200 dark:divide-gray-700">
                                        <!-- Usuários serão carregados aqui dinamicamente -->
                                        <tr>
                                            <td colspan="4" class="px-4 py-4 text-center text-gray-500 dark:text-gray-400">Nenhum usuário cadastrado</td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>
    
    <!-- Modal de Confirmação para Limpar Dados -->
    <div id="modal-limpar-dados" class="fixed inset-0 bg-black bg-opacity-50 hidden flex items-center justify-center p-4 z-50">
        <div class="bg-white dark:bg-gray-800 rounded-lg shadow-xl w-full max-w-md p-6 transform transition-all scale-100">
            <div class="mb-6">
                <div class="flex items-center justify-center mb-4 text-red-500">
                    <i class="fas fa-exclamation-circle text-5xl"></i>
                </div>
                <h2 class="text-xl font-semibold mb-2 text-gray-800 dark:text-gray-100 text-center">Atenção!</h2>
                <p class="text-gray-600 dark:text-gray-300 text-center mb-2">Você está prestes a apagar <strong>todos os dados</strong> do sistema.</p>
                <p class="text-gray-600 dark:text-gray-300 text-center font-bold">Esta ação é irreversível!</p>
            </div>
            
            <!-- Confirmação por digitação -->
            <div class="mb-4">
                <label for="confirmacao-texto" class="block mb-1 text-gray-700 dark:text-gray-300 text-sm">Digite "CONFIRMAR" para continuar:</label>
                <input type="text" id="confirmacao-texto" class="w-full px-4 py-2 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-800 dark:text-white text-base focus:outline-none focus:ring-2 focus:ring-red-500 focus:border-transparent">
            </div>
            
            <div class="flex justify-center space-x-4">
                <button type="button" id="btn-cancelar-limpar" class="px-4 py-2 bg-gray-300 hover:bg-gray-400 dark:bg-gray-700 dark:hover:bg-gray-600 text-gray-800 dark:text-gray-200 rounded-lg transition flex-1">
                    Cancelar
                </button>
                <button type="button" id="btn-confirmar-limpar" class="px-4 py-2 bg-red-600 opacity-50 cursor-not-allowed text-white rounded-lg transition flex-1 flex items-center justify-center" disabled>
                    <i class="fas fa-trash-alt mr-2"></i>
                    Limpar Tudo
                </button>
            </div>
        </div>
    </div>
    
    <!-- Modal de Exclusão de Usuário -->
    <div id="modal-excluir-usuario" class="fixed inset-0 bg-black bg-opacity-50 hidden z-50">
        <div class="flex items-center justify-center min-h-screen p-4">
            <div class="bg-white dark:bg-gray-800 rounded-lg shadow-xl w-full max-w-md p-6 transform transition-all scale-100">
                <div class="mb-6">
                    <div class="flex items-center justify-center mb-4 text-red-500">
                        <i class="fas fa-user-times text-5xl"></i>
                    </div>
                    <h2 class="text-xl font-semibold mb-2 text-gray-800 dark:text-gray-100 text-center">Excluir Usuário</h2>
                    <p class="text-gray-600 dark:text-gray-300 text-center">Tem certeza que deseja excluir este usuário? Esta ação não pode ser desfeita.</p>
                </div>
                
                <input type="hidden" id="usuario-excluir-id">
                
                <div class="flex justify-center space-x-4">
                    <button type="button" id="btn-cancelar-excluir-usuario" class="px-4 py-2 bg-gray-300 hover:bg-gray-400 dark:bg-gray-700 dark:hover:bg-gray-600 text-gray-800 dark:text-gray-200 rounded-lg transition flex-1">
                        Cancelar
                    </button>
                    <button type="button" id="btn-confirmar-excluir-usuario" class="px-4 py-2 bg-red-600 hover:bg-red-700 text-white rounded-lg transition flex-1 flex items-center justify-center">
                        <i class="fas fa-trash-alt mr-2"></i>
                        Excluir
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Verificação de suporte ao localStorage
        function checkLocalStorageSupport() {
            try {
                const test = 'test';
                localStorage.setItem(test, test);
                localStorage.removeItem(test);
                return true;
            } catch (e) {
                console.error("LocalStorage não está disponível:", e);
                return false;
            }
        }
        
        // Simulação de banco de dados usando localStorage
        const DB = {
            // Usuário padrão admin
            defaultAdmin: {
                id: "admin-1",
                name: "Administrador",
                email: "admin@ggomes.com",
                password: "admin123",
                isAdmin: true,
                createdAt: new Date().toISOString()
            },
            
            // Inicializa o banco de dados local
            init() {
                if (!checkLocalStorageSupport()) {
                    mostrarToast("Seu navegador não suporta armazenamento local. O sistema pode não funcionar corretamente.", "error");
                    return;
                }
                
                try {
                    // Verificar se já existe algum dado
                    if (!localStorage.getItem('ggomes_users')) {
                        // Criar usuário admin padrão
                        localStorage.setItem('ggomes_users', JSON.stringify([this.defaultAdmin]));
                    }
                    
                    // Inicializar outras coleções se não existirem
                    if (!localStorage.getItem('ggomes_colhedoras')) {
                        localStorage.setItem('ggomes_colhedoras', JSON.stringify([]));
                    }
                    
                    if (!localStorage.getItem('ggomes_registros')) {
                        localStorage.setItem('ggomes_registros', JSON.stringify([]));
                    }
                    
                    if (!localStorage.getItem('ggomes_caminhoes')) {
                        localStorage.setItem('ggomes_caminhoes', JSON.stringify([]));
                    }
                    
                    // Inicializar configurações
                    if (!localStorage.getItem('ggomes_config')) {
                        localStorage.setItem('ggomes_config', JSON.stringify({
                            registrosPorPagina: 10,
                            formatoData: 'dd/MM/yyyy',
                            temaEscuro: document.documentElement.classList.contains('dark')
                        }));
                    }
                } catch (error) {
                    console.error("Erro ao inicializar o banco de dados:", error);
                    mostrarToast("Erro ao inicializar o sistema. Verifique o console para mais detalhes.", "error");
                }
            },
            
            // Funções para usuários
            users: {
                getAll() {
                    try {
                        return JSON.parse(localStorage.getItem('ggomes_users') || '[]');
                    } catch (e) {
                        console.error("Erro ao obter usuários:", e);
                        return [];
                    }
                },
                
                get(id) {
                    try {
                        const users = this.getAll();
                        return users.find(user => user.id === id) || null;
                    } catch (e) {
                        console.error("Erro ao obter usuário:", e);
                        return null;
                    }
                },
                
                getByEmail(email) {
                    try {
                        if (!email) return null;
                        const users = this.getAll();
                        return users.find(user => user.email.toLowerCase() === email.toLowerCase()) || null;
                    } catch (e) {
                        console.error("Erro ao obter usuário por email:", e);
                        return null;
                    }
                },
                
                add(user) {
                    try {
                        const users = this.getAll();
                        
                        // Gerar ID único
                        user.id = 'user-' + Date.now();
                        
                        // Adicionar data de criação
                        user.createdAt = new Date().toISOString();
                        
                        users.push(user);
                        localStorage.setItem('ggomes_users', JSON.stringify(users));
                        return user;
                    } catch (e) {
                        console.error("Erro ao adicionar usuário:", e);
                        throw new Error("Não foi possível adicionar o usuário");
                    }
                },
                
                update(user) {
                    try {
                        const users = this.getAll();
                        const index = users.findIndex(u => u.id === user.id);
                        
                        if (index !== -1) {
                            users[index] = { ...users[index], ...user };
                            localStorage.setItem('ggomes_users', JSON.stringify(users));
                            return users[index];
                        }
                        
                        return null;
                    } catch (e) {
                        console.error("Erro ao atualizar usuário:", e);
                        throw new Error("Não foi possível atualizar o usuário");
                    }
                },
                
                remove(id) {
                    try {
                        let users = this.getAll();
                        users = users.filter(user => user.id !== id);
                        localStorage.setItem('ggomes_users', JSON.stringify(users));
                    } catch (e) {
                        console.error("Erro ao remover usuário:", e);
                        throw new Error("Não foi possível remover o usuário");
                    }
                }
            },
            
            // Funções para colhedoras
            colhedoras: {
                getAll() {
                    try {
                        return JSON.parse(localStorage.getItem('ggomes_colhedoras') || '[]');
                    } catch (e) {
                        console.error("Erro ao obter colhedoras:", e);
                        return [];
                    }
                },
                
                get(id) {
                    try {
                        const colhedoras = this.getAll();
                        return colhedoras.find(c => c.id === id) || null;
                    } catch (e) {
                        console.error("Erro ao obter colhedora:", e);
                        return null;
                    }
                },
                
                add(colhedora) {
                    try {
                        const colhedoras = this.getAll();
                        
                        // Verificar se ID já existe
                        if (colhedoras.some(c => c.id === colhedora.id)) {
                            throw new Error("Colhedora com este ID já existe");
                        }
                        
                        colhedoras.push(colhedora);
                        localStorage.setItem('ggomes_colhedoras', JSON.stringify(colhedoras));
                        return colhedora;
                    } catch (e) {
                        console.error("Erro ao adicionar colhedora:", e);
                        throw e;
                    }
                },
                
                update(colhedora) {
                    try {
                        const colhedoras = this.getAll();
                        const index = colhedoras.findIndex(c => c.id === colhedora.id);
                        
                        if (index !== -1) {
                            colhedoras[index] = colhedora;
                            localStorage.setItem('ggomes_colhedoras', JSON.stringify(colhedoras));
                            return colhedora;
                        }
                        
                        return null;
                    } catch (e) {
                        console.error("Erro ao atualizar colhedora:", e);
                        throw new Error("Não foi possível atualizar a colhedora");
                    }
                },
                
                remove(id) {
                    try {
                        let colhedoras = this.getAll();
                        colhedoras = colhedoras.filter(c => c.id !== id);
                        localStorage.setItem('ggomes_colhedoras', JSON.stringify(colhedoras));
                    } catch (e) {
                        console.error("Erro ao remover colhedora:", e);
                        throw new Error("Não foi possível remover a colhedora");
                    }
                }
            },
            
            // Funções para registros
            registros: {
                getAll() {
                    try {
                        return JSON.parse(localStorage.getItem('ggomes_registros') || '[]');
                    } catch (e) {
                        console.error("Erro ao obter registros:", e);
                        return [];
                    }
                },
                
                get(id) {
                    try {
                        const registros = this.getAll();
                        return registros.find(r => r.id === id) || null;
                    } catch (e) {
                        console.error("Erro ao obter registro:", e);
                        return null;
                    }
                },
                
                add(registro) {
                    try {
                        const registros = this.getAll();
                        
                        // Gerar ID único
                        registro.id = 'reg-' + Date.now();
                        
                        // Adicionar data de criação
                        registro.createdAt = new Date().toISOString();
                        
                        registros.push(registro);
                        localStorage.setItem('ggomes_registros', JSON.stringify(registros));
                        return registro;
                    } catch (e) {
                        console.error("Erro ao adicionar registro:", e);
                        throw new Error("Não foi possível adicionar o registro");
                    }
                },
                
                update(registro) {
                    try {
                        const registros = this.getAll();
                        const index = registros.findIndex(r => r.id === registro.id);
                        
                        if (index !== -1) {
                            registros[index] = registro;
                            localStorage.setItem('ggomes_registros', JSON.stringify(registros));
                            return registro;
                        }
                        
                        return null;
                    } catch (e) {
                        console.error("Erro ao atualizar registro:", e);
                        throw new Error("Não foi possível atualizar o registro");
                    }
                },
                
                remove(id) {
                    try {
                        let registros = this.getAll();
                        registros = registros.filter(r => r.id !== id);
                        localStorage.setItem('ggomes_registros', JSON.stringify(registros));
                    } catch (e) {
                        console.error("Erro ao remover registro:", e);
                        throw new Error("Não foi possível remover o registro");
                    }
                },
                
                // Novo método: obter registros por período
                getByPeriod(days) {
                    try {
                        const registros = this.getAll();
                        if (!days) return registros;
                        
                        const today = new Date();
                        const startDate = new Date();
                        startDate.setDate(today.getDate() - days);
                        
                        return registros.filter(r => {
                            const regDate = new Date(r.data);
                            return regDate >= startDate && regDate <= today;
                        });
                    } catch (e) {
                        console.error("Erro ao obter registros por período:", e);
                        return [];
                    }
                },
                
                // Novo método: calcular tendências
                getTrends(currentPeriodDays) {
                    try {
                        // Obter registros do período atual
                        const currentRegistros = this.getByPeriod(currentPeriodDays);
                        
                        // Obter registros do período anterior de mesma duração
                        const today = new Date();
                        const previousEndDate = new Date();
                        previousEndDate.setDate(today.getDate() - currentPeriodDays);
                        
                        const previousStartDate = new Date();
                        previousStartDate.setDate(previousEndDate.getDate() - currentPeriodDays);
                        
                        const allRegistros = this.getAll();
                        const previousRegistros = allRegistros.filter(r => {
                            const regDate = new Date(r.data);
                            return regDate >= previousStartDate && regDate <= previousEndDate;
                        });
                        
                        // Calcular totais atuais
                        let currentTotalColhido = 0;
                        let currentAreaTotal = 0;
                        let currentHorasTotal = 0;
                        
                        currentRegistros.forEach(reg => {
                            currentTotalColhido += Number(reg.quantidade) || 0;
                            currentAreaTotal += Number(reg.area) || 0;
                            currentHorasTotal += Number(reg.horas) || 0;
                        });
                        
                        // Calcular totais do período anterior
                        let previousTotalColhido = 0;
                        let previousAreaTotal = 0;
                        let previousHorasTotal = 0;
                        
                        previousRegistros.forEach(reg => {
                            previousTotalColhido += Number(reg.quantidade) || 0;
                            previousAreaTotal += Number(reg.area) || 0;
                            previousHorasTotal += Number(reg.horas) || 0;
                        });
                        
                        // Calcular produtividade e rendimento médios por colhedora
                        const currentColhedoras = new Map();
                        const previousColhedoras = new Map();
                        
                        // Inicializar dados para o cálculo da média de produtividade/rendimento para período atual
                        currentRegistros.forEach(reg => {
                            if (!reg.colhedoraId) return;
                            
                            if (!currentColhedoras.has(reg.colhedoraId)) {
                                currentColhedoras.set(reg.colhedoraId, {
                                    quantidade: 0,
                                    area: 0,
                                    horas: 0
                                });
                            }
                            
                            const stats = currentColhedoras.get(reg.colhedoraId);
                            stats.quantidade += Number(reg.quantidade) || 0;
                            stats.area += Number(reg.area) || 0;
                            stats.horas += Number(reg.horas) || 0;
                        });
                        
                        // Inicializar dados para o cálculo da média de produtividade/rendimento para período anterior
                        previousRegistros.forEach(reg => {
                            if (!reg.colhedoraId) return;
                            
                            if (!previousColhedoras.has(reg.colhedoraId)) {
                                previousColhedoras.set(reg.colhedoraId, {
                                    quantidade: 0,
                                    area: 0,
                                    horas: 0
                                });
                            }
                            
                            const stats = previousColhedoras.get(reg.colhedoraId);
                            stats.quantidade += Number(reg.quantidade) || 0;
                            stats.area += Number(reg.area) || 0;
                            stats.horas += Number(reg.horas) || 0;
                        });
                        
                        // Calcular produtividade para cada colhedora e média total (período atual)
                        let currentProdutividadeTotal = 0;
                        let currentColhedorasComArea = 0;
                        
                        currentColhedoras.forEach(stats => {
                            if (stats.area > 0) {
                                stats.produtividade = stats.quantidade / stats.area;
                                currentProdutividadeTotal += stats.produtividade;
                                currentColhedorasComArea++;
                            }
                        });
                        
                        const currentProdutividade = currentColhedorasComArea > 0 
                            ? currentProdutividadeTotal / currentColhedorasComArea 
                            : 0;
                        
                        // Calcular rendimento para cada colhedora e média total (período atual)
                        let currentRendimentoTotal = 0;
                        let currentColhedorasComHoras = 0;
                        
                        currentColhedoras.forEach(stats => {
                            if (stats.horas > 0) {
                                stats.rendimento = stats.quantidade / stats.horas;
                                currentRendimentoTotal += stats.rendimento;
                                currentColhedorasComHoras++;
                            }
                        });
                        
                        const currentRendimento = currentColhedorasComHoras > 0 
                            ? currentRendimentoTotal / currentColhedorasComHoras 
                            : 0;
                        
                        // Calcular produtividade para cada colhedora e média total (período anterior)
                        let previousProdutividadeTotal = 0;
                        let previousColhedorasComArea = 0;
                        
                        previousColhedoras.forEach(stats => {
                            if (stats.area > 0) {
                                stats.produtividade = stats.quantidade / stats.area;
                                previousProdutividadeTotal += stats.produtividade;
                                previousColhedorasComArea++;
                            }
                        });
                        
                        const previousProdutividade = previousColhedorasComArea > 0 
                            ? previousProdutividadeTotal / previousColhedorasComArea 
                            : 0;
                        
                        // Calcular rendimento para cada colhedora e média total (período anterior)
                        let previousRendimentoTotal = 0;
                        let previousColhedorasComHoras = 0;
                        
                        previousColhedoras.forEach(stats => {
                            if (stats.horas > 0) {
                                stats.rendimento = stats.quantidade / stats.horas;
                                previousRendimentoTotal += stats.rendimento;
                                previousColhedorasComHoras++;
                            }
                        });
                        
                        const previousRendimento = previousColhedorasComHoras > 0 
                            ? previousRendimentoTotal / previousColhedorasComHoras 
                            : 0;
                        
                        // Calcular tendências (variação percentual)
                        const calcPercentChange = (current, previous) => {
                            if (previous === 0) return current > 0 ? 100 : 0;
                            return ((current - previous) / previous) * 100;
                        };
                        
                        return {
                            totalColhido: {
                                current: currentTotalColhido,
                                previous: previousTotalColhido,
                                change: calcPercentChange(currentTotalColhido, previousTotalColhido)
                            },
                            areaTotal: {
                                current: currentAreaTotal,
                                previous: previousAreaTotal,
                                change: calcPercentChange(currentAreaTotal, previousAreaTotal)
                            },
                            produtividade: {
                                current: currentProdutividade,
                                previous: previousProdutividade,
                                change: calcPercentChange(currentProdutividade, previousProdutividade)
                            },
                            rendimento: {
                                current: currentRendimento,
                                previous: previousRendimento,
                                change: calcPercentChange(currentRendimento, previousRendimento)
                            },
                            totalRegistros: {
                                current: currentRegistros.length,
                                previous: previousRegistros.length,
                                change: calcPercentChange(currentRegistros.length, previousRegistros.length)
                            }
                        };
                    } catch (e) {
                        console.error("Erro ao calcular tendências:", e);
                        return null;
                    }
                },
                
                // Obter dados para gráficos temporais
                getTimeSeriesData(days) {
                    try {
                        const registros = this.getByPeriod(days);
                        
                        // Agrupar por data
                        const dataMap = new Map();
                        
                        // Criar datas para todo o período solicitado
                        const today = new Date();
                        for (let i = days; i >= 0; i--) {
                            const date = new Date();
                            date.setDate(today.getDate() - i);
                            const dateString = date.toISOString().split('T')[0];
                            dataMap.set(dateString, {
                                date: dateString,
                                quantidade: 0,
                                area: 0
                            });
                        }
                        
                        // Preencher dados reais
                        registros.forEach(reg => {
                            const dateString = reg.data;
                            if (dataMap.has(dateString)) {
                                const dayData = dataMap.get(dateString);
                                dayData.quantidade += Number(reg.quantidade) || 0;
                                dayData.area += Number(reg.area) || 0;
                            }
                        });
                        
                        // Converter para array ordenado por data
                        return Array.from(dataMap.values()).sort((a, b) => {
                            return new Date(a.date) - new Date(b.date);
                        });
                    } catch (e) {
                        console.error("Erro ao obter dados de série temporal:", e);
                        return [];
                    }
                },
                
                // Obter estatísticas por cultura
                getStatsByCategory(category = 'cultura', period = null) {
                    try {
                        const registros = period ? this.getByPeriod(period) : this.getAll();
                        
                        // Agrupar por categoria (ex: cultura)
                        const categoryMap = new Map();
                        
                        registros.forEach(reg => {
                            const categoryValue = reg[category] || 'Não especificado';
                            
                            if (!categoryMap.has(categoryValue)) {
                                categoryMap.set(categoryValue, {
                                    name: categoryValue,
                                    quantidade: 0,
                                    area: 0,
                                    horas: 0,
                                    registros: 0
                                });
                            }
                            
                            const stats = categoryMap.get(categoryValue);
                            stats.quantidade += Number(reg.quantidade) || 0;
                            stats.area += Number(reg.area) || 0;
                            stats.horas += Number(reg.horas) || 0;
                            stats.registros += 1;
                        });
                        
                        // Calcular produtividade e rendimento
                        categoryMap.forEach(stats => {
                            stats.produtividade = stats.area > 0 ? stats.quantidade / stats.area : 0;
                            stats.rendimento = stats.horas > 0 ? stats.quantidade / stats.horas : 0;
                        });
                        
                        // Converter para array
                        return Array.from(categoryMap.values());
                    } catch (e) {
                        console.error(`Erro ao obter estatísticas por ${category}:`, e);
                        return [];
                    }
                },
                
                // Obter melhores desempenhos
                getBestPerformers(period = null) {
                    try {
                        // Estatísticas por colhedora
                        const colhedoraStats = this.getStatsByCategory('colhedoraId', period);
                        
                        // Estatísticas por cultura
                        const culturaStats = this.getStatsByCategory('cultura', period);
                        
                        // Encontrar os melhores desempenhos
                        const bestProductivityColhedora = colhedoraStats.reduce((best, current) => 
                            (current.produtividade > best.produtividade) ? current : best, 
                            { produtividade: 0 });
                        
                        const bestVolumeColhedora = colhedoraStats.reduce((best, current) => 
                            (current.quantidade > best.quantidade) ? current : best, 
                            { quantidade: 0 });
                            
                        const bestYieldColhedora = colhedoraStats.reduce((best, current) => 
                            (current.rendimento > best.rendimento) ? current : best, 
                            { rendimento: 0 });
                            
                        const bestProductivityCultura = culturaStats.reduce((best, current) => 
                            (current.produtividade > best.produtividade) ? current : best, 
                            { produtividade: 0 });
                        
                        const bestVolumeCultura = culturaStats.reduce((best, current) => 
                            (current.quantidade > best.quantidade) ? current : best, 
                            { quantidade: 0 });
                            
                        const bestAreaCultura = culturaStats.reduce((best, current) => 
                            (current.area > best.area) ? current : best, 
                            { area: 0 });
                        
                        return {
                            colhedoras: {
                                bestProductivity: bestProductivityColhedora,
                                bestVolume: bestVolumeColhedora,
                                bestYield: bestYieldColhedora,
                                all: colhedoraStats
                            },
                            culturas: {
                                bestProductivity: bestProductivityCultura,
                                bestVolume: bestVolumeCultura,
                                bestArea: bestAreaCultura,
                                all: culturaStats
                            }
                        };
                    } catch (e) {
                        console.error("Erro ao obter melhores desempenhos:", e);
                        return null;
                    }
                }
            },
            
            // Funções para caminhões
            caminhoes: {
                getAll() {
                    try {
                        return JSON.parse(localStorage.getItem('ggomes_caminhoes') || '[]');
                    } catch (e) {
                        console.error("Erro ao obter caminhões:", e);
                        return [];
                    }
                },
                
                get(id) {
                    try {
                        const caminhoes = this.getAll();
                        return caminhoes.find(c => c.id === id) || null;
                    } catch (e) {
                        console.error("Erro ao obter caminhão:", e);
                        return null;
                    }
                },
                
                add(caminhao) {
                    try {
                        const caminhoes = this.getAll();
                        
                        // Gerar ID único
                        caminhao.id = 'cam-' + Date.now();
                        
                        // Adicionar data de criação
                        caminhao.createdAt = new Date().toISOString();
                        
                        caminhoes.push(caminhao);
                        localStorage.setItem('ggomes_caminhoes', JSON.stringify(caminhoes));
                        return caminhao;
                    } catch (e) {
                        console.error("Erro ao adicionar caminhão:", e);
                        throw new Error("Não foi possível adicionar o caminhão");
                    }
                },
                
                update(caminhao) {
                    try {
                        const caminhoes = this.getAll();
                        const index = caminhoes.findIndex(c => c.id === caminhao.id);
                        
                        if (index !== -1) {
                            caminhoes[index] = caminhao;
                            localStorage.setItem('ggomes_caminhoes', JSON.stringify(caminhoes));
                            return caminhao;
                        }
                        
                        return null;
                    } catch (e) {
                        console.error("Erro ao atualizar caminhão:", e);
                        throw new Error("Não foi possível atualizar o caminhão");
                    }
                },
                
                remove(id) {
                    try {
                        let caminhoes = this.getAll();
                        caminhoes = caminhoes.filter(c => c.id !== id);
                        localStorage.setItem('ggomes_caminhoes', JSON.stringify(caminhoes));
                    } catch (e) {
                        console.error("Erro ao remover caminhão:", e);
                        throw new Error("Não foi possível remover o caminhão");
                    }
                },
                
                // Novo método: obter caminhões por período
                getByPeriod(days) {
                    try {
                        const caminhoes = this.getAll();
                        if (!days) return caminhoes;
                        
                        const today = new Date();
                        const startDate = new Date();
                        startDate.setDate(today.getDate() - days);
                        
                        return caminhoes.filter(c => {
                            const camDate = new Date(c.data);
                            return camDate >= startDate && camDate <= today;
                        });
                    } catch (e) {
                        console.error("Erro ao obter caminhões por período:", e);
                        return [];
                    }
                },
                
                // Obter tendências dos tempos de caminhões
                getTrends(currentPeriodDays) {
                    try {
                        // Obter caminhões do período atual
                        const currentCaminhoes = this.getByPeriod(currentPeriodDays);
                        
                        // Obter caminhões do período anterior
                        const today = new Date();
                        const previousEndDate = new Date();
                        previousEndDate.setDate(today.getDate() - currentPeriodDays);
                        
                        const previousStartDate = new Date();
                        previousStartDate.setDate(previousEndDate.getDate() - currentPeriodDays);
                        
                        const allCaminhoes = this.getAll();
                        const previousCaminhoes = allCaminhoes.filter(c => {
                            const regDate = new Date(c.data);
                            return regDate >= previousStartDate && regDate <= previousEndDate;
                        });
                        
                        // Calcular médias atuais
                        let currentTotalCampo = 0;
                        let currentTotalPatio = 0;
                        
                        currentCaminhoes.forEach(c => {
                            currentTotalCampo += Number(c.tempoCampo) || 0;
                            currentTotalPatio += Number(c.tempoPatio) || 0;
                        });
                        
                        const currentMediaCampo = currentCaminhoes.length > 0 ? currentTotalCampo / currentCaminhoes.length : 0;
                        const currentMediaPatio = currentCaminhoes.length > 0 ? currentTotalPatio / currentCaminhoes.length : 0;
                        
                        // Calcular médias do período anterior
                        let previousTotalCampo = 0;
                        let previousTotalPatio = 0;
                        
                        previousCaminhoes.forEach(c => {
                            previousTotalCampo += Number(c.tempoCampo) || 0;
                            previousTotalPatio += Number(c.tempoPatio) || 0;
                        });
                        
                        const previousMediaCampo = previousCaminhoes.length > 0 ? previousTotalCampo / previousCaminhoes.length : 0;
                        const previousMediaPatio = previousCaminhoes.length > 0 ? previousTotalPatio / previousCaminhoes.length : 0;
                        
                        // Calcular tendências
                        const calcPercentChange = (current, previous) => {
                            if (previous === 0) return current > 0 ? 100 : 0;
                            return ((current - previous) / previous) * 100;
                        };
                        
                        return {
                            tempoCampo: {
                                current: currentMediaCampo,
                                previous: previousMediaCampo,
                                change: calcPercentChange(currentMediaCampo, previousMediaCampo)
                            },
                            tempoPatio: {
                                current: currentMediaPatio,
                                previous: previousMediaPatio,
                                change: calcPercentChange(currentMediaPatio, previousMediaPatio)
                            },
                            totalCaminhoes: {
                                current: currentCaminhoes.length,
                                previous: previousCaminhoes.length,
                                change: calcPercentChange(currentCaminhoes.length, previousCaminhoes.length)
                            }
                        };
                    } catch (e) {
                        console.error("Erro ao calcular tendências de caminhões:", e);
                        return null;
                    }
                },
                
                // Obter dados para gráfico de tempos
                getTimeSeriesData(days) {
                    try {
                        const caminhoes = this.getByPeriod(days);
                        
                        // Agrupar por data
                        const dataMap = new Map();
                        
                        // Criar datas para todo o período solicitado
                        const today = new Date();
                        for (let i = days; i >= 0; i--) {
                            const date = new Date();
                            date.setDate(today.getDate() - i);
                            const dateString = date.toISOString().split('T')[0];
                            dataMap.set(dateString, {
                                date: dateString,
                                tempoCampo: 0,
                                tempoPatio: 0,
                                count: 0
                            });
                        }
                        
                        // Somar tempos por data
                        caminhoes.forEach(c => {
                            const dateString = c.data;
                            if (dataMap.has(dateString)) {
                                const dayData = dataMap.get(dateString);
                                dayData.tempoCampo += Number(c.tempoCampo) || 0;
                                dayData.tempoPatio += Number(c.tempoPatio) || 0;
                                dayData.count += 1;
                            }
                        });
                        
                        // Calcular médias
                        dataMap.forEach(dayData => {
                            if (dayData.count > 0) {
                                dayData.tempoCampoMedio = dayData.tempoCampo / dayData.count;
                                dayData.tempoPatioMedio = dayData.tempoPatio / dayData.count;
                            } else {
                                dayData.tempoCampoMedio = 0;
                                dayData.tempoPatioMedio = 0;
                            }
                        });
                        
                        // Converter para array ordenado por data
                        return Array.from(dataMap.values()).sort((a, b) => {
                            return new Date(a.date) - new Date(b.date);
                        });
                    } catch (e) {
                        console.error("Erro ao obter dados de série temporal de caminhões:", e);
                        return [];
                    }
                }
            },
            
            // Configurações do usuário
            config: {
                get() {
                    try {
                        return JSON.parse(localStorage.getItem('ggomes_config') || '{}');
                    } catch (e) {
                        console.error("Erro ao obter configurações:", e);
                        return {
                            registrosPorPagina: 10,
                            formatoData: 'dd/MM/yyyy',
                            temaEscuro: document.documentElement.classList.contains('dark')
                        };
                    }
                },
                
                update(config) {
                    try {
                        localStorage.setItem('ggomes_config', JSON.stringify(config));
                    } catch (e) {
                        console.error("Erro ao atualizar configurações:", e);
                        throw new Error("Não foi possível atualizar as configurações");
                    }
                }
            },
            
            // Exportar todos os dados
            exportData() {
                try {
                    const data = {
                        users: this.users.getAll(),
                        colhedoras: this.colhedoras.getAll(),
                        registros: this.registros.getAll(),
                        caminhoes: this.caminhoes.getAll(),
                        config: this.config.get(),
                        exportDate: new Date().toISOString(),
                        version: '1.0.0'
                    };
                    
                    return JSON.stringify(data, null, 2);
                } catch (e) {
                    console.error("Erro ao exportar dados:", e);
                    throw new Error("Não foi possível exportar os dados");
                }
            },
            
            // Importar dados
            importData(jsonData) {
                try {
                    const data = JSON.parse(jsonData);
                    
                    // Validar que o formato dos dados é válido
                    if (!data.users || !data.colhedoras || !data.registros || !data.caminhoes || !data.config) {
                        throw new Error("Formato de dados inválido para importação");
                    }
                    
                    // Importar dados mantendo pelo menos o usuário admin padrão
                    const adminUser = this.users.getByEmail("admin@ggomes.com");
                    
                    // Preservar usuário admin atual se não estiver nos dados importados
                    const adminInImport = data.users.find(u => u.email === "admin@ggomes.com");
                    if (!adminInImport && adminUser) {
                        data.users.push(adminUser);
                    }
                    
                    // Importar todos os dados
                    localStorage.setItem('ggomes_users', JSON.stringify(data.users));
                    localStorage.setItem('ggomes_colhedoras', JSON.stringify(data.colhedoras));
                    localStorage.setItem('ggomes_registros', JSON.stringify(data.registros));
                    localStorage.setItem('ggomes_caminhoes', JSON.stringify(data.caminhoes));
                    localStorage.setItem('ggomes_config', JSON.stringify(data.config));
                    
                    return true;
                } catch (e) {
                    console.error("Erro ao importar dados:", e);
                    throw new Error("Não foi possível importar os dados: " + e.message);
                }
            },
            
            // Limpar todos os dados
            clearAll() {
                try {
                    // Preservar apenas o usuário admin
                    const adminUser = this.users.getByEmail("admin@ggomes.com");
                    
                    localStorage.setItem('ggomes_colhedoras', JSON.stringify([]));
                    localStorage.setItem('ggomes_registros', JSON.stringify([]));
                    localStorage.setItem('ggomes_caminhoes', JSON.stringify([]));
                    
                    // Preservar usuário admin se existir
                    if (adminUser) {
                        localStorage.setItem('ggomes_users', JSON.stringify([adminUser]));
                    }
                } catch (e) {
                    console.error("Erro ao limpar dados:", e);
                    throw new Error("Não foi possível limpar os dados");
                }
            }
        };
        
        // Inicializar o banco de dados
        DB.init();
        
        // Estado da aplicação
        const estado = {
            user: null,
            colhedoras: [],
            registros: [],
            caminhoes: [],
            config: {
                registrosPorPagina: 10,
                formatoData: 'dd/MM/yyyy',
                temaEscuro: document.documentElement.classList.contains('dark')
            },
            paginacao: {
                paginaAtual: 1,
                totalPaginas: 1,
                registrosPorPagina: 10
            },
            filtros: {
                colhedora: '',
                cultura: '',
                dataInicio: '',
                dataFim: ''
            },
            culturas: [],
            dashboard: {
                period: 30,
                charts: {},
                trends: null,
                bestPerformers: null
            }
        };
        
        // Autenticação
        const Auth = {
            // Login com email e senha
            login(email, password) {
                try {
                    const user = DB.users.getByEmail(email);
                    
                    if (user && user.password === password) {
                        estado.user = user;
                        
                        // Atualizar interface com base no tipo de usuário
                        this.updateUI();
                        
                        return true;
                    }
                    
                    return false;
                } catch (e) {
                    console.error("Erro ao fazer login:", e);
                    mostrarToast("Erro ao fazer login. Tente novamente.", "error");
                    return false;
                }
            },
            
            // Verificar se usuário está autenticado
            isAuthenticated() {
                return estado.user !== null;
            },
            
            // Verificar se usuário é administrador
            isAdmin() {
                return estado.user && estado.user.isAdmin;
            },
            
            // Logout
            logout() {
                estado.user = null;
                showLoginForm();
            },
            
            // Atualizar interface com base no tipo de usuário
            updateUI() {
                try {
                    // Mostrar/ocultar elementos baseado no tipo de usuário
                    document.querySelectorAll('.admin-only').forEach(element => {
                        if (this.isAdmin()) {
                            element.classList.remove('hidden');
                        } else {
                            element.classList.add('hidden');
                        }
                    });
                    
                    // Atualizar informações do usuário
                    if (estado.user) {
                        document.getElementById('user-name').textContent = estado.user.name;
                        document.getElementById('user-info-name').textContent = estado.user.name;
                        document.getElementById('user-info-email').textContent = estado.user.email;
                        document.getElementById('user-info-role').textContent = estado.user.isAdmin ? 'Administrador' : 'Usuário';
                        
                        // Atualizar badge de função
                        const badge = document.getElementById('user-role-badge');
                        if (estado.user.isAdmin) {
                            badge.textContent = "Administrador";
                            badge.className = "px-2 py-1 rounded text-xs font-medium bg-red-100 text-red-800 dark:bg-red-900/30 dark:text-red-400";
                        } else {
                            badge.textContent = "Usuário";
                            badge.className = "px-2 py-1 rounded text-xs font-medium bg-blue-100 text-blue-800 dark:bg-blue-900/30 dark:text-blue-400";
                        }
                    }
                } catch (e) {
                    console.error("Erro ao atualizar interface:", e);
                }
            }
        };
        
        // Mostrar formulário de login
        function showLoginForm() {
            document.getElementById('auth-container').classList.remove('hidden');
            document.getElementById('app-container').classList.add('hidden');
            document.getElementById('login-form').classList.remove('hidden');
            document.getElementById('auth-loader').classList.add('hidden');
            
            // Limpar campos de formulário
            document.getElementById('login-email').value = '';
            document.getElementById('login-password').value = '';
        }
        
        // Mostrar aplicação principal
        function showApp() {
            document.getElementById('auth-container').classList.add('hidden');
            document.getElementById('app-container').classList.remove('hidden');
        }
        
        // Mostrar loader de autenticação
        function showAuthLoader() {
            document.getElementById('login-form').classList.add('hidden');
            document.getElementById('auth-loader').classList.remove('hidden');
        }
        
        // Esconder loader de autenticação
        function hideAuthLoader() {
            document.getElementById('auth-loader').classList.add('hidden');
            document.getElementById('login-form').classList.remove('hidden');
        }
        
        // Mostrar notificação toast
        function mostrarToast(mensagem, tipo = 'success') {
            // Remover toasts anteriores
            document.querySelectorAll('.toast').forEach(toast => toast.remove());
            
            const iconMap = {
                'success': 'fa-check-circle',
                'error': 'fa-exclamation-circle',
                'warning': 'fa-exclamation-triangle',
                'info': 'fa-info-circle'
            };
            
            const colorMap = {
                'success': 'bg-green-50 dark:bg-green-900/20 text-green-800 dark:text-green-200',
                'error': 'bg-red-50 dark:bg-red-900/20 text-red-800 dark:text-red-200',
                'warning': 'bg-yellow-50 dark:bg-yellow-900/20 text-yellow-800 dark:text-yellow-200',
                'info': 'bg-blue-50 dark:bg-blue-900/20 text-blue-800 dark:text-blue-200'
            };
            
            const toast = document.createElement('div');
            toast.className = `toast ${colorMap[tipo]} toast-${tipo} p-4 rounded-lg shadow-lg`;
            toast.innerHTML = `
                <div class="flex items-center">
                    <i class="fas ${iconMap[tipo]} mr-3"></i>
                    <p>${mensagem}</p>
                </div>
            `;
            
            document.getElementById('toast-container').appendChild(toast);
            
            // Remover automaticamente após 3 segundos
            setTimeout(() => {
                toast.remove();
            }, 3000);
        }
        
        // Alternar tema claro/escuro
        function alternarTema() {
            try {
                const isDark = document.documentElement.classList.toggle('dark');
                estado.config.temaEscuro = isDark;
                
                const toggleSwitch = document.getElementById('toggle-theme-switch');
                if (toggleSwitch) {
                    toggleSwitch.checked = isDark;
                }
                
                // Salvar configuração
                DB.config.update(estado.config);
                
                // Atualizar gráficos se estiverem inicializados
                atualizarGraficos();
            } catch (e) {
                console.error("Erro ao alternar tema:", e);
                mostrarToast("Erro ao alternar tema", "error");
            }
        }
        
        // Função para alternar entre páginas do conteúdo
        function alternarPagina(pagina) {
            try {
                document.querySelectorAll('.content').forEach(content => {
                    content.classList.add('hidden');
                });
                
                document.querySelectorAll('.sidebar-link').forEach(link => {
                    link.classList.remove('active', 'bg-primary-100', 'dark:bg-primary-900', 'text-primary-700', 'dark:text-primary-300');
                    link.classList.add('hover:bg-gray-100', 'dark:hover:bg-gray-700');
                });
                
                const contentElement = document.getElementById(`content-${pagina}`);
                if (contentElement) {
                    contentElement.classList.remove('hidden');
                }
                
                const linkElement = document.querySelector(`a[href="#${pagina}"]`);
                if (linkElement) {
                    linkElement.classList.add('active', 'bg-primary-100', 'dark:bg-primary-900', 'text-primary-700', 'dark:text-primary-300');
                    linkElement.classList.remove('hover:bg-gray-100', 'dark:hover:bg-gray-700');
                }
                
                // Atualizar dados específicos de cada página
                if (pagina === 'usuarios') {
                    carregarUsuarios();
                } else if (pagina === 'dashboard') {
                    atualizarDashboard();
                } else if (pagina === 'colhedoras') {
                    atualizarListaColhedoras();
                } else if (pagina === 'registros') {
                    atualizarListaCulturas();
                    atualizarTabelaRegistros();
                } else if (pagina === 'producao') {
                    atualizarResumoProducao();
                } else if (pagina === 'caminhoes') {
                    atualizarDadosCaminhoes();
                }
            } catch (e) {
                console.error("Erro ao alternar página:", e);
                mostrarToast("Erro ao carregar a página", "error");
            }
        }
        
        // Formatar número com separador de milhares e casas decimais
        function formatarNumero(numero, casasDecimais = 0) {
            try {
                return Number(numero).toLocaleString('pt-BR', {
                    minimumFractionDigits: casasDecimais,
                    maximumFractionDigits: casasDecimais
                });
            } catch (e) {
                console.error("Erro ao formatar número:", e);
                return numero;
            }
        }
        
        // Formatar data conforme o formato selecionado nas configurações
        function formatarData(dataString) {
            try {
                const data = new Date(dataString);
                const formato = estado.config.formatoData;
                
                const dia = data.getDate().toString().padStart(2, '0');
                const mes = (data.getMonth() + 1).toString().padStart(2, '0');
                const ano = data.getFullYear();
                
                if (formato === 'dd/MM/yyyy') {
                    return `${dia}/${mes}/${ano}`;
                } else if (formato === 'MM/dd/yyyy') {
                    return `${mes}/${dia}/${ano}`;
                } else { // yyyy-MM-dd
                    return `${ano}-${mes}-${dia}`;
                }
            } catch (e) {
                console.error("Erro ao formatar data:", e);
                return dataString;
            }
        }
        
        // Mostrar seta de tendência
        function renderizarTendencia(elemento, variacao) {
            try {
                if (!elemento) return;
                
                let html = '';
                
                if (variacao > 0) {
                    html = `<i class="fas fa-arrow-up mr-1 text-green-500"></i>
                            <span class="text-green-600 dark:text-green-400">+${formatarNumero(variacao, 1)}% vs. período anterior</span>`;
                } else if (variacao < 0) {
                    html = `<i class="fas fa-arrow-down mr-1 text-red-500"></i>
                            <span class="text-red-600 dark:text-red-400">${formatarNumero(variacao, 1)}% vs. período anterior</span>`;
                } else {
                    html = `<i class="fas fa-minus mr-1 text-gray-500"></i>
                            <span class="text-gray-600 dark:text-gray-400">Sem variação</span>`;
                }
                
                elemento.innerHTML = html;
            } catch (e) {
                console.error("Erro ao renderizar tendência:", e);
            }
        }
        
        // Renderizar gráfico de produção ao longo do tempo
        function renderizarGraficoProducaoTempo() {
            try {
                const ctx = document.getElementById('chart-producao-tempo');
                if (!ctx) return;
                
                // Destruir gráfico anterior se existir
                if (estado.dashboard.charts.producaoTempo) {
                    estado.dashboard.charts.producaoTempo.destroy();
                }
                
                // Obter dados da série temporal
                const period = Number(estado.dashboard.period || 30);
                const timeData = DB.registros.getTimeSeriesData(period);
                
                // Formatação para labels de data
                const labels = timeData.map(d => {
                    const date = new Date(d.date);
                    return date.toLocaleDateString('pt-BR', { day: '2-digit', month: '2-digit' });
                });
                
                const isDark = document.documentElement.classList.contains('dark');
                const gridColor = isDark ? 'rgba(255, 255, 255, 0.1)' : 'rgba(0, 0, 0, 0.1)';
                const textColor = isDark ? '#e5e7eb' : '#1f2937';
                
                estado.dashboard.charts.producaoTempo = new Chart(ctx, {
                    type: 'line',
                    data: {
                        labels: labels,
                        datasets: [
                            {
                                label: 'Produção (T)',
                                data: timeData.map(d => d.quantidade),
                                fill: true,
                                backgroundColor: 'rgba(93, 92, 222, 0.2)',
                                borderColor: 'rgba(93, 92, 222, 1)',
                                borderWidth: 2,
                                tension: 0.3,
                                pointRadius: 3,
                                pointBackgroundColor: 'rgba(93, 92, 222, 1)'
                            }
                        ]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                labels: {
                                    color: textColor
                                }
                            },
                            tooltip: {
                                mode: 'index',
                                intersect: false
                            }
                        },
                        scales: {
                            y: {
                                beginAtZero: true,
                                grid: {
                                    color: gridColor
                                },
                                ticks: {
                                    color: textColor
                                }
                            },
                            x: {
                                grid: {
                                    color: gridColor
                                },
                                ticks: {
                                    color: textColor
                                }
                            }
                        }
                    }
                });
            } catch (e) {
                console.error("Erro ao renderizar gráfico de produção:", e);
            }
        }
        
        // Renderizar gráfico de distribuição por cultura
        function renderizarGraficoCulturas() {
            try {
                const ctx = document.getElementById('chart-culturas');
                if (!ctx) return;
                
                // Destruir gráfico anterior se existir
                if (estado.dashboard.charts.culturas) {
                    estado.dashboard.charts.culturas.destroy();
                }
                
                // Obter estatísticas por cultura
                const period = Number(estado.dashboard.period || 30);
                const culturaStats = DB.registros.getStatsByCategory('cultura', period);
                
                // Cores para o gráfico
                const cores = [
                    'rgba(93, 92, 222, 0.8)',   // primary
                    'rgba(52, 211, 153, 0.8)',  // green
                    'rgba(251, 191, 36, 0.8)',  // yellow
                    'rgba(239, 68, 68, 0.8)',   // red
                    'rgba(96, 165, 250, 0.8)',  // blue
                    'rgba(167, 139, 250, 0.8)', // purple
                    'rgba(248, 113, 113, 0.8)', // red-light
                    'rgba(52, 211, 153, 0.8)',  // green-light
                ];
                
                const isDark = document.documentElement.classList.contains('dark');
                const textColor = isDark ? '#e5e7eb' : '#1f2937';
                
                estado.dashboard.charts.culturas = new Chart(ctx, {
                    type: 'doughnut',
                    data: {
                        labels: culturaStats.map(c => c.name),
                        datasets: [{
                            data: culturaStats.map(c => c.quantidade),
                            backgroundColor: culturaStats.map((_, index) => cores[index % cores.length]),
                            borderWidth: 1,
                            borderColor: isDark ? '#374151' : '#f9fafb'
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                position: 'right',
                                labels: {
                                    color: textColor,
                                    padding: 15,
                                    font: {
                                        size: 12
                                    }
                                }
                            },
                            tooltip: {
                                callbacks: {
                                    label: function(context) {
                                        const value = context.raw;
                                        const total = context.dataset.data.reduce((a, b) => a + b, 0);
                                        const percentage = ((value / total) * 100).toFixed(1);
                                        return `${context.label}: ${formatarNumero(value)} T (${percentage}%)`;
                                    }
                                }
                            }
                        }
                    }
                });
            } catch (e) {
                console.error("Erro ao renderizar gráfico de culturas:", e);
            }
        }
        
        // Renderizar gráfico de comparação de colhedoras
        function renderizarGraficoColhedorasComparacao() {
            try {
                const ctx = document.getElementById('chart-colhedoras-comparacao');
                if (!ctx) return;
                
                // Destruir gráfico anterior se existir
                if (estado.dashboard.charts.colhedorasComparacao) {
                    estado.dashboard.charts.colhedorasComparacao.destroy();
                }
                
                const period = Number(estado.dashboard.period || 30);
                const bestPerformers = DB.registros.getBestPerformers(period);
                
                if (!bestPerformers || !bestPerformers.colhedoras || !bestPerformers.colhedoras.all) {
                    ctx.parentElement.innerHTML = '<div class="flex items-center justify-center h-full"><p class="text-gray-500 dark:text-gray-400">Sem dados suficientes</p></div>';
                    return;
                }
                
                // Ordenar por produção total
                const colhedoras = [...bestPerformers.colhedoras.all].sort((a, b) => b.quantidade - a.quantidade).slice(0, 5);
                
                // Se não tiver dados, mostrar mensagem
                if (colhedoras.length === 0) {
                    ctx.parentElement.innerHTML = '<div class="flex items-center justify-center h-full"><p class="text-gray-500 dark:text-gray-400">Sem dados suficientes</p></div>';
                    return;
                }
                
                const isDark = document.documentElement.classList.contains('dark');
                const gridColor = isDark ? 'rgba(255, 255, 255, 0.1)' : 'rgba(0, 0, 0, 0.1)';
                const textColor = isDark ? '#e5e7eb' : '#1f2937';
                
                estado.dashboard.charts.colhedorasComparacao = new Chart(ctx, {
                    type: 'bar',
                    data: {
                        labels: colhedoras.map(c => c.name),
                        datasets: [{
                            label: 'Produção Total (T)',
                            data: colhedoras.map(c => c.quantidade),
                            backgroundColor: 'rgba(93, 92, 222, 0.8)',
                            borderColor: 'rgba(93, 92, 222, 1)',
                            borderWidth: 1
                        }, {
                            label: 'Produtividade (T/ha)',
                            data: colhedoras.map(c => c.produtividade),
                            backgroundColor: 'rgba(52, 211, 153, 0.8)',
                            borderColor: 'rgba(52, 211, 153, 1)',
                            borderWidth: 1
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        indexAxis: 'y',
                        plugins: {
                            legend: {
                                position: 'top',
                                labels: {
                                    color: textColor
                                }
                            },
                            tooltip: {
                                callbacks: {
                                    label: function(context) {
                                        const datasetLabel = context.dataset.label || '';
                                        const value = context.raw;
                                        if (datasetLabel.includes('Produtividade')) {
                                            return `${datasetLabel}: ${formatarNumero(value, 2)} T/ha`;
                                        }
                                        return `${datasetLabel}: ${formatarNumero(value, 0)} T`;
                                    }
                                }
                            }
                        },
                        scales: {
                            x: {
                                beginAtZero: true,
                                grid: {
                                    color: gridColor
                                },
                                ticks: {
                                    color: textColor
                                }
                            },
                            y: {
                                grid: {
                                    color: gridColor
                                },
                                ticks: {
                                    color: textColor
                                }
                            }
                        }
                    }
                });
            } catch (e) {
                console.error("Erro ao renderizar gráfico de comparação de colhedoras:", e);
            }
        }
        
        // Renderizar gráfico de comparação de culturas
        function renderizarGraficoCulturasComparacao() {
            try {
                const ctx = document.getElementById('chart-culturas-comparacao');
                if (!ctx) return;
                
                // Destruir gráfico anterior se existir
                if (estado.dashboard.charts.culturasComparacao) {
                    estado.dashboard.charts.culturasComparacao.destroy();
                }
                
                const period = Number(estado.dashboard.period || 30);
                const bestPerformers = DB.registros.getBestPerformers(period);
                
                if (!bestPerformers || !bestPerformers.culturas || !bestPerformers.culturas.all) {
                    ctx.parentElement.innerHTML = '<div class="flex items-center justify-center h-full"><p class="text-gray-500 dark:text-gray-400">Sem dados suficientes</p></div>';
                    return;
                }
                
                // Ordenar por produção total
                const culturas = [...bestPerformers.culturas.all].sort((a, b) => b.quantidade - a.quantidade).slice(0, 5);
                
                // Se não tiver dados, mostrar mensagem
                if (culturas.length === 0) {
                    ctx.parentElement.innerHTML = '<div class="flex items-center justify-center h-full"><p class="text-gray-500 dark:text-gray-400">Sem dados suficientes</p></div>';
                    return;
                }
                
                const isDark = document.documentElement.classList.contains('dark');
                const gridColor = isDark ? 'rgba(255, 255, 255, 0.1)' : 'rgba(0, 0, 0, 0.1)';
                const textColor = isDark ? '#e5e7eb' : '#1f2937';
                
                estado.dashboard.charts.culturasComparacao = new Chart(ctx, {
                    type: 'bar',
                    data: {
                        labels: culturas.map(c => c.name),
                        datasets: [{
                            label: 'Produção Total (T)',
                            data: culturas.map(c => c.quantidade),
                            backgroundColor: 'rgba(251, 191, 36, 0.8)',
                            borderColor: 'rgba(251, 191, 36, 1)',
                            borderWidth: 1
                        }, {
                            label: 'Área (ha)',
                            data: culturas.map(c => c.area),
                            backgroundColor: 'rgba(96, 165, 250, 0.8)',
                            borderColor: 'rgba(96, 165, 250, 1)',
                            borderWidth: 1
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        indexAxis: 'y',
                        plugins: {
                            legend: {
                                position: 'top',
                                labels: {
                                    color: textColor
                                }
                            },
                            tooltip: {
                                callbacks: {
                                    label: function(context) {
                                        const datasetLabel = context.dataset.label || '';
                                        const value = context.raw;
                                        if (datasetLabel.includes('Área')) {
                                            return `${datasetLabel}: ${formatarNumero(value, 2)} ha`;
                                        }
                                        return `${datasetLabel}: ${formatarNumero(value, 0)} T`;
                                    }
                                }
                            }
                        },
                        scales: {
                            x: {
                                beginAtZero: true,
                                grid: {
                                    color: gridColor
                                },
                                ticks: {
                                    color: textColor
                                }
                            },
                            y: {
                                grid: {
                                    color: gridColor
                                },
                                ticks: {
                                    color: textColor
                                }
                            }
                        }
                    }
                });
            } catch (e) {
                console.error("Erro ao renderizar gráfico de comparação de culturas:", e);
            }
        }
        
        // Renderizar gráfico de tempos de caminhões
        function renderizarGraficoCaminhoesTempo() {
            try {
                const ctx = document.getElementById('chart-caminhoes-tempo');
                if (!ctx) return;
                
                // Destruir gráfico anterior se existir
                if (estado.dashboard.charts.caminhoesTempo) {
                    estado.dashboard.charts.caminhoesTempo.destroy();
                }
                
                const period = Number(estado.dashboard.period || 30);
                const timeData = DB.caminhoes.getTimeSeriesData(period);
                
                // Formatação para labels de data
                const labels = timeData.map(d => {
                    const date = new Date(d.date);
                    return date.toLocaleDateString('pt-BR', { day: '2-digit', month: '2-digit' });
                });
                
                const isDark = document.documentElement.classList.contains('dark');
                const gridColor = isDark ? 'rgba(255, 255, 255, 0.1)' : 'rgba(0, 0, 0, 0.1)';
                const textColor = isDark ? '#e5e7eb' : '#1f2937';
                
                estado.dashboard.charts.caminhoesTempo = new Chart(ctx, {
                    type: 'line',
                    data: {
                        labels: labels,
                        datasets: [
                            {
                                label: 'Tempo Campo (min)',
                                data: timeData.map(d => d.tempoCampoMedio),
                                fill: false,
                                borderColor: 'rgba(52, 211, 153, 1)',
                                backgroundColor: 'rgba(52, 211, 153, 0.5)',
                                borderWidth: 2,
                                tension: 0.3,
                                pointRadius: 3
                            },
                            {
                                label: 'Tempo Pátio (min)',
                                data: timeData.map(d => d.tempoPatioMedio),
                                fill: false,
                                borderColor: 'rgba(96, 165, 250, 1)',
                                backgroundColor: 'rgba(96, 165, 250, 0.5)',
                                borderWidth: 2,
                                tension: 0.3,
                                pointRadius: 3
                            }
                        ]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                position: 'top',
                                labels: {
                                    color: textColor
                                }
                            },
                            tooltip: {
                                mode: 'index',
                                intersect: false
                            }
                        },
                        scales: {
                            y: {
                                beginAtZero: true,
                                grid: {
                                    color: gridColor
                                },
                                ticks: {
                                    color: textColor
                                },
                                title: {
                                    display: true,
                                    text: 'Minutos',
                                    color: textColor
                                }
                            },
                            x: {
                                grid: {
                                    color: gridColor
                                },
                                ticks: {
                                    color: textColor
                                }
                            }
                        }
                    }
                });
            } catch (e) {
                console.error("Erro ao renderizar gráfico de tempos de caminhões:", e);
            }
        }
        
        // Atualizar gráficos do dashboard
        function atualizarGraficos() {
            try {
                renderizarGraficoProducaoTempo();
                renderizarGraficoCulturas();
                renderizarGraficoColhedorasComparacao();
                renderizarGraficoCulturasComparacao();
                renderizarGraficoCaminhoesTempo();
            } catch (e) {
                console.error("Erro ao atualizar gráficos:", e);
            }
        }
        
        // Atualizar KPIs de desempenho
        function atualizarKPIsDesempenho() {
            try {
                const period = Number(estado.dashboard.period || 30);
                const bestPerformers = DB.registros.getBestPerformers(period);
                estado.dashboard.bestPerformers = bestPerformers;
                
                // Se não tiver dados, não tentar atualizar
                if (!bestPerformers) return;
                
                // Elementos para Colhedoras
                const bestProdColhedora = document.getElementById('best-productivity-colhedora');
                const bestProdValue = document.getElementById('best-productivity-value');
                const bestVolColhedora = document.getElementById('best-volume-colhedora');
                const bestVolValue = document.getElementById('best-volume-value');
                const bestYieldColhedora = document.getElementById('best-yield-colhedora');
                const bestYieldValue = document.getElementById('best-yield-value');
                
                // Elementos para Culturas
                const bestProdCultura = document.getElementById('best-productivity-cultura');
                const bestProdCulturaValue = document.getElementById('best-productivity-cultura-value');
                const bestVolCultura = document.getElementById('best-volume-cultura');
                const bestVolCulturaValue = document.getElementById('best-volume-cultura-value');
                const bestAreaCultura = document.getElementById('best-area-cultura');
                const bestAreaCulturaValue = document.getElementById('best-area-cultura-value');
                
                // Atualizar colhedoras
                if (bestPerformers.colhedoras) {
                    const { bestProductivity, bestVolume, bestYield } = bestPerformers.colhedoras;
                    
                    if (bestProdColhedora && bestProductivity) {
                        bestProdColhedora.textContent = bestProductivity.name || '-';
                        bestProdValue.textContent = formatarNumero(bestProductivity.produtividade, 2) + ' T/ha';
                    }
                    
                    if (bestVolColhedora && bestVolume) {
                        bestVolColhedora.textContent = bestVolume.name || '-';
                        bestVolValue.textContent = formatarNumero(bestVolume.quantidade) + ' T';
                    }
                    
                    if (bestYieldColhedora && bestYield) {
                        bestYieldColhedora.textContent = bestYield.name || '-';
                        bestYieldValue.textContent = formatarNumero(bestYield.rendimento, 2) + ' T/h';
                    }
                }
                
                // Atualizar culturas
                if (bestPerformers.culturas) {
                    const { bestProductivity, bestVolume, bestArea } = bestPerformers.culturas;
                    
                    if (bestProdCultura && bestProductivity) {
                        bestProdCultura.textContent = bestProductivity.name || '-';
                        bestProdCulturaValue.textContent = formatarNumero(bestProductivity.produtividade, 2) + ' T/ha';
                    }
                    
                    if (bestVolCultura && bestVolume) {
                        bestVolCultura.textContent = bestVolume.name || '-';
                        bestVolCulturaValue.textContent = formatarNumero(bestVolume.quantidade) + ' T';
                    }
                    
                    if (bestAreaCultura && bestArea) {
                        bestAreaCultura.textContent = bestArea.name || '-';
                        bestAreaCulturaValue.textContent = formatarNumero(bestArea.area, 2) + ' ha';
                    }
                }
            } catch (e) {
                console.error("Erro ao atualizar KPIs de desempenho:", e);
            }
        }
        
        // Atualizar o Dashboard
        function atualizarDashboard() {
            try {
                // Obter período selecionado
                const periodSelect = document.getElementById('dashboard-period');
                if (periodSelect) {
                    estado.dashboard.period = Number(periodSelect.value);
                }
                
                // Calcular tendências
                const trends = DB.registros.getTrends(estado.dashboard.period);
                estado.dashboard.trends = trends;
                
                // Calcular tendências de caminhões
                const caminhoesTrends = DB.caminhoes.getTrends(estado.dashboard.period);
                
                // Atualizar contadores
                document.getElementById('qtd-colhedoras').textContent = estado.colhedoras.length;
                document.getElementById('qtd-registros').textContent = estado.registros.length;
                
                // Se não tem dados, mostrar zeros
                if (!trends) {
                    document.getElementById('dash-total-colhido').textContent = '0 T';
                    document.getElementById('dash-area-total').textContent = '0 ha';
                    document.getElementById('dash-produtividade').textContent = '0 T/ha';
                    document.getElementById('dash-rendimento').textContent = '0 T/h';
                    
                    // Esconder as tendências
                    document.getElementById('dash-total-trend').innerHTML = '<span class="text-gray-600 dark:text-gray-400">Sem dados suficientes</span>';
                    document.getElementById('dash-area-trend').innerHTML = '<span class="text-gray-600 dark:text-gray-400">Sem dados suficientes</span>';
                    document.getElementById('dash-produtividade-trend').innerHTML = '<span class="text-gray-600 dark:text-gray-400">Sem dados suficientes</span>';
                    document.getElementById('dash-rendimento-trend').innerHTML = '<span class="text-gray-600 dark:text-gray-400">Sem dados suficientes</span>';
                    
                    // Barras de progresso
                    document.getElementById('dash-total-progress').style.width = '0%';
                    document.getElementById('dash-area-progress').style.width = '0%';
                    document.getElementById('dash-produtividade-progress').style.width = '0%';
                    document.getElementById('dash-rendimento-progress').style.width = '0%';
                } else {
                    // Atualizar estatísticas no dashboard
                    document.getElementById('dash-total-colhido').textContent = formatarNumero(trends.totalColhido.current) + ' T';
                    document.getElementById('dash-area-total').textContent = formatarNumero(trends.areaTotal.current, 2) + ' ha';
                    document.getElementById('dash-produtividade').textContent = formatarNumero(trends.produtividade.current, 2) + ' T/ha';
                    document.getElementById('dash-rendimento').textContent = formatarNumero(trends.rendimento.current, 2) + ' T/h';
                    
                    // Atualizar tendências
                    renderizarTendencia(document.getElementById('dash-total-trend'), trends.totalColhido.change);
                    renderizarTendencia(document.getElementById('dash-area-trend'), trends.areaTotal.change);
                    renderizarTendencia(document.getElementById('dash-produtividade-trend'), trends.produtividade.change);
                    renderizarTendencia(document.getElementById('dash-rendimento-trend'), trends.rendimento.change);
                    
                    // Atualizar barras de progresso (usaremos valores relativos em relação à meta ou máximo histórico)
                    // Aqui estamos assumindo que o máximo histórico é 20% maior que o valor atual para simplificar
                    const progTotal = Math.min(trends.totalColhido.current / (trends.totalColhido.current * 1.2) * 100, 100);
                    const progArea = Math.min(trends.areaTotal.current / (trends.areaTotal.current * 1.2) * 100, 100);
                    const progProd = Math.min(trends.produtividade.current / (trends.produtividade.current * 1.2) * 100, 100);
                    const progRend = Math.min(trends.rendimento.current / (trends.rendimento.current * 1.2) * 100, 100);
                    
                    document.getElementById('dash-total-progress').style.width = progTotal + '%';
                    document.getElementById('dash-area-progress').style.width = progArea + '%';
                    document.getElementById('dash-produtividade-progress').style.width = progProd + '%';
                    document.getElementById('dash-rendimento-progress').style.width = progRend + '%';
                }
                
                // Estatísticas de caminhões
                if (!caminhoesTrends) {
                    document.getElementById('dash-tempo-campo').textContent = '0 min';
                    document.getElementById('dash-tempo-patio').textContent = '0 min';
                    document.getElementById('dash-total-caminhoes').textContent = '0';
                    document.getElementById('dash-caminhoes-trend').innerHTML = '<span class="text-gray-600 dark:text-gray-400">Sem dados suficientes</span>';
                } else {
                    document.getElementById('dash-tempo-campo').textContent = formatarNumero(caminhoesTrends.tempoCampo.current) + ' min';
                    document.getElementById('dash-tempo-patio').textContent = formatarNumero(caminhoesTrends.tempoPatio.current) + ' min';
                    document.getElementById('dash-total-caminhoes').textContent = caminhoesTrends.totalCaminhoes.current;
                    
                    // Tendência total de caminhões
                    renderizarTendencia(document.getElementById('dash-caminhoes-trend'), caminhoesTrends.totalCaminhoes.change);
                    
                    // Barras de progresso de tempos (valores de exemplo)
                    document.getElementById('dash-tempo-campo-progress').style.width = '45%'; // Valor estático para exemplo
                    document.getElementById('dash-tempo-patio-progress').style.width = '30%'; // Valor estático para exemplo
                }
                
                // Atualizar KPIs de desempenho
                atualizarKPIsDesempenho();
                
                // Atualizar gráficos
                atualizarGraficos();
                
            } catch (e) {
                console.error("Erro ao atualizar dashboard:", e);
            }
        }
        
        // Atualizar lista de culturas (para filtros)
        function atualizarListaCulturas() {
            try {
                // Obter todas as culturas únicas nos registros
                const culturas = new Set();
                estado.registros.forEach(reg => {
                    if (reg && reg.cultura) {
                        culturas.add(reg.cultura);
                    }
                });
                
                // Atualizar select de filtro de cultura
                const select = document.getElementById('filtro-cultura');
                if (!select) return;
                
                // Preservar valor selecionado atual
                const valorAtual = select.value;
                
                // Limpar select
                select.innerHTML = '<option value="">Todas</option>';
                
                // Adicionar opções de cultura
                culturas.forEach(cultura => {
                    const option = document.createElement('option');
                    option.value = cultura;
                    option.textContent = cultura;
                    select.appendChild(option);
                });
                
                // Restaurar valor selecionado
                if (valorAtual && select.querySelector(`option[value="${valorAtual}"]`)) {
                    select.value = valorAtual;
                }
                
                // Atualizar também o estado
                estado.culturas = Array.from(culturas);
                
            } catch (e) {
                console.error("Erro ao atualizar lista de culturas:", e);
            }
        }
        
        // Atualizar resumo de produção
        function atualizarResumoProducao() {
            try {
                // Calcular totais
                let totalColhido = 0;
                let areaTotal = 0;
                let horasTotal = 0;
                
                estado.registros.forEach(reg => {
                    if (!reg) return;
                    totalColhido += Number(reg.quantidade) || 0;
                    areaTotal += Number(reg.area) || 0;
                    horasTotal += Number(reg.horas) || 0;
                });
                
                // Calcular produtividade e rendimento por colhedora e então média
                const produtividadesPorColhedora = new Map();
                const rendimentosPorColhedora = new Map();
                
                // Inicializar para cada colhedora
                estado.colhedoras.forEach(colhedora => {
                    produtividadesPorColhedora.set(colhedora.id, {
                        quantidade: 0,
                        area: 0,
                        produtividade: 0
                    });
                    
                    rendimentosPorColhedora.set(colhedora.id, {
                        quantidade: 0,
                        horas: 0,
                        rendimento: 0
                    });
                });
                
                // Calcular acumulados por colhedora
                estado.registros.forEach(reg => {
                    if (!reg || !reg.colhedoraId) return;
                    
                    const prodStats = produtividadesPorColhedora.get(reg.colhedoraId);
                    const rendStats = rendimentosPorColhedora.get(reg.colhedoraId);
                    
                    if (prodStats) {
                        prodStats.quantidade += Number(reg.quantidade) || 0;
                        prodStats.area += Number(reg.area) || 0;
                    }
                    
                    if (rendStats) {
                        rendStats.quantidade += Number(reg.quantidade) || 0;
                        rendStats.horas += Number(reg.horas) || 0;
                    }
                });
                
                // Calcular produtividade e rendimento para cada colhedora
                let produtividadeTotal = 0;
                let rendimentoTotal = 0;
                let colhedorasComProducao = 0;
                let colhedorasComHoras = 0;
                
                produtividadesPorColhedora.forEach(stats => {
                    if (stats.area > 0) {
                        stats.produtividade = stats.quantidade / stats.area;
                        produtividadeTotal += stats.produtividade;
                        colhedorasComProducao++;
                    }
                });
                
                rendimentosPorColhedora.forEach(stats => {
                    if (stats.horas > 0) {
                        stats.rendimento = stats.quantidade / stats.horas;
                        rendimentoTotal += stats.rendimento;
                        colhedorasComHoras++;
                    }
                });
                
                // Calcular médias finais (baseadas na quantidade de colhedoras com registros)
                const produtividadeMedia = colhedorasComProducao > 0 ? produtividadeTotal / colhedorasComProducao : 0;
                const rendimentoMedio = colhedorasComHoras > 0 ? rendimentoTotal / colhedorasComHoras : 0;
                
                // Atualizar estatísticas
                document.getElementById('total-colhido').textContent = formatarNumero(totalColhido) + ' T';
                document.getElementById('area-total').textContent = formatarNumero(areaTotal, 2) + ' ha';
                document.getElementById('produtividade-media').textContent = formatarNumero(produtividadeMedia, 2) + ' T/ha';
                document.getElementById('rendimento-medio').textContent = formatarNumero(rendimentoMedio, 2) + ' T/h';
                
                // Atualizar tabela de colhedoras
                atualizarTabelaColhedoras();
                
            } catch (e) {
                console.error("Erro ao atualizar resumo de produção:", e);
            }
        }
        
        // Atualizar tabela de colhedoras com estatísticas
        function atualizarTabelaColhedoras() {
            try {
                const tbody = document.getElementById('tabela-colhedoras');
                if (!tbody) return;
                
                if (!estado.colhedoras || estado.colhedoras.length === 0) {
                    tbody.innerHTML = '<tr><td colspan="4" class="px-4 py-4 text-center text-gray-500 dark:text-gray-400">Nenhuma colhedora registrada</td></tr>';
                    return;
                }
                
                tbody.innerHTML = '';
                
                // Criar um mapa com estatísticas por colhedora
                const estatisticasPorColhedora = new Map();
                
                // Inicializar estatísticas para cada colhedora
                estado.colhedoras.forEach(colhedora => {
                    estatisticasPorColhedora.set(colhedora.id, {
                        id: colhedora.id,
                        modelo: colhedora.modelo || '',
                        totalColhido: 0,
                        areaTotal: 0,
                        produtividade: 0
                    });
                });
                
                // Acumular estatísticas
                estado.registros.forEach(reg => {
                    if (!reg || !reg.colhedoraId) return;
                    
                    const stats = estatisticasPorColhedora.get(reg.colhedoraId);
                    if (!stats) return;
                    
                    stats.totalColhido += Number(reg.quantidade) || 0;
                    stats.areaTotal += Number(reg.area) || 0;
                });
                
                // Calcular produtividade e criar linhas da tabela
                estatisticasPorColhedora.forEach(stats => {
                    stats.produtividade = stats.areaTotal > 0 ? stats.totalColhido / stats.areaTotal : 0;
                    
                    const tr = document.createElement('tr');
                    tr.innerHTML = `
                        <td class="px-4 py-3">${stats.id} - ${stats.modelo}</td>
                        <td class="px-4 py-3 text-right">${formatarNumero(stats.totalColhido)}</td>
                        <td class="px-4 py-3 text-right">${formatarNumero(stats.areaTotal, 2)}</td>
                        <td class="px-4 py-3 text-right">${formatarNumero(stats.produtividade, 2)}</td>
                    `;
                    tbody.appendChild(tr);
                });
                
            } catch (e) {
                console.error("Erro ao atualizar tabela de colhedoras:", e);
            }
        }
        
        // Atualizar tabela de registros (histórico)
        function atualizarTabelaRegistros() {
            try {
                const tbody = document.getElementById('tabela-registros');
                if (!tbody) return;
                
                if (!estado.registros || estado.registros.length === 0) {
                    tbody.innerHTML = '<tr><td colspan="9" class="px-4 py-4 text-center text-gray-500 dark:text-gray-400">Nenhum registro encontrado</td></tr>';
                    document.getElementById('registros-contagem').textContent = '0';
                    return;
                }
                
                // Filtrar registros de acordo com os filtros aplicados
                let registrosFiltrados = [...estado.registros];
                
                if (estado.filtros.colhedora) {
                    registrosFiltrados = registrosFiltrados.filter(r => r.colhedoraId === estado.filtros.colhedora);
                }
                
                if (estado.filtros.cultura) {
                    registrosFiltrados = registrosFiltrados.filter(r => r.cultura === estado.filtros.cultura);
                }
                
                if (estado.filtros.dataInicio) {
                    const dataInicio = new Date(estado.filtros.dataInicio);
                    registrosFiltrados = registrosFiltrados.filter(r => new Date(r.data) >= dataInicio);
                }
                
                if (estado.filtros.dataFim) {
                    const dataFim = new Date(estado.filtros.dataFim);
                    dataFim.setHours(23, 59, 59, 999); // Fim do dia
                    registrosFiltrados = registrosFiltrados.filter(r => new Date(r.data) <= dataFim);
                }
                
                // Ordenar por data (mais recente primeiro)
                registrosFiltrados.sort((a, b) => new Date(b.data) - new Date(a.data));
                
                // Paginação
                const inicio = (estado.paginacao.paginaAtual - 1) * estado.config.registrosPorPagina;
                const fim = inicio + estado.config.registrosPorPagina;
                const registrosPaginados = registrosFiltrados.slice(inicio, fim);
                
                // Atualizar contador de registros
                document.getElementById('registros-contagem').textContent = registrosFiltrados.length.toString();
                
                // Atualizar informações de paginação
                estado.paginacao.totalPaginas = Math.ceil(registrosFiltrados.length / estado.config.registrosPorPagina);
                document.getElementById('paginacao-info').textContent = `Página ${estado.paginacao.paginaAtual} de ${estado.paginacao.totalPaginas || 1}`;
                
                // Habilitar/desabilitar botões de paginação
                document.getElementById('btn-pagina-anterior').disabled = estado.paginacao.paginaAtual <= 1;
                document.getElementById('btn-proxima-pagina').disabled = estado.paginacao.paginaAtual >= estado.paginacao.totalPaginas;
                
                // Limpar tabela
                tbody.innerHTML = '';
                
                // Se não houver registros na página atual
                if (registrosPaginados.length === 0) {
                    tbody.innerHTML = '<tr><td colspan="9" class="px-4 py-4 text-center text-gray-500 dark:text-gray-400">Nenhum registro encontrado</td></tr>';
                    return;
                }
                
                // Criar linhas da tabela
                registrosPaginados.forEach(reg => {
                    const colhedora = estado.colhedoras.find(c => c.id === reg.colhedoraId) || { id: reg.colhedoraId, modelo: '' };
                    const produtividade = reg.area > 0 ? reg.quantidade / reg.area : 0;
                    const rendimento = reg.horas > 0 ? reg.quantidade / reg.horas : 0;
                    
                    const tr = document.createElement('tr');
                    tr.innerHTML = `
                        <td class="px-4 py-3">${formatarData(reg.data)}</td>
                        <td class="px-4 py-3">${colhedora.id} - ${colhedora.modelo}</td>
                        <td class="px-4 py-3">${reg.cultura || '-'}</td>
                        <td class="px-4 py-3 text-right">${formatarNumero(reg.quantidade)}</td>
                        <td class="px-4 py-3 text-right">${formatarNumero(reg.area, 2)}</td>
                        <td class="px-4 py-3 text-right">${formatarNumero(reg.horas, 1)}</td>
                        <td class="px-4 py-3 text-right">${formatarNumero(produtividade, 2)}</td>
                        <td class="px-4 py-3 text-right">${formatarNumero(rendimento, 2)}</td>
                        <td class="px-4 py-3 text-center admin-only">
                            <button data-id="${reg.id}" class="btn-excluir-registro text-red-600 hover:text-red-800 dark:text-red-400 dark:hover:text-red-300" title="Excluir registro">
                                <i class="fas fa-trash-alt"></i>
                            </button>
                        </td>
                    `;
                    tbody.appendChild(tr);
                });
                
                // Adicionar event listeners para botões de exclusão
                document.querySelectorAll('.btn-excluir-registro').forEach(btn => {
                    btn.addEventListener('click', function() {
                        const regId = this.getAttribute('data-id');
                        excluirRegistro(regId);
                    });
                });
                
            } catch (e) {
                console.error("Erro ao atualizar tabela de registros:", e);
            }
        }
        
        // Atualizar dados de caminhões
        function atualizarDadosCaminhoes() {
            try {
                // Se não houver registros de caminhões
                if (!estado.caminhoes || estado.caminhoes.length === 0) {
                    document.getElementById('media-campo').textContent = '0 min';
                    document.getElementById('media-patio').textContent = '0 min';
                    document.getElementById('total-registros-caminhoes').textContent = '0';
                    document.getElementById('tempo-total-medio').textContent = '0 min';
                    
                    document.getElementById('tabela-medias-caminhoes').innerHTML = '<tr><td colspan="4" class="px-4 py-4 text-center text-gray-500 dark:text-gray-400">Nenhum registro de caminhão</td></tr>';
                    document.getElementById('tabela-historico-caminhoes').innerHTML = '<tr><td colspan="6" class="px-4 py-4 text-center text-gray-500 dark:text-gray-400">Nenhum registro encontrado</td></tr>';
                    return;
                }
                
                // Obter data de filtro
                const filtroDataElement = document.getElementById('data-filtro-caminhoes');
                const dataFiltro = filtroDataElement && filtroDataElement.value ? filtroDataElement.value : null;
                
                // Filtrar caminhões por data se houver filtro
                let caminhoesExibidos = [...estado.caminhoes];
                if (dataFiltro) {
                    caminhoesExibidos = caminhoesExibidos.filter(c => c.data === dataFiltro);
                }
                
                // Calcular médias
                let totalCampo = 0;
                let totalPatio = 0;
                let totalGeral = 0;
                
                caminhoesExibidos.forEach(c => {
                    totalCampo += Number(c.tempoCampo) || 0;
                    totalPatio += Number(c.tempoPatio) || 0;
                    totalGeral += (Number(c.tempoCampo) || 0) + (Number(c.tempoPatio) || 0);
                });
                
                const mediaCampo = caminhoesExibidos.length > 0 ? totalCampo / caminhoesExibidos.length : 0;
                const mediaPatio = caminhoesExibidos.length > 0 ? totalPatio / caminhoesExibidos.length : 0;
                const mediaTotal = caminhoesExibidos.length > 0 ? totalGeral / caminhoesExibidos.length : 0;
                
                // Atualizar estatísticas
                document.getElementById('media-campo').textContent = formatarNumero(mediaCampo) + ' min';
                document.getElementById('media-patio').textContent = formatarNumero(mediaPatio) + ' min';
                document.getElementById('total-registros-caminhoes').textContent = caminhoesExibidos.length.toString();
                document.getElementById('tempo-total-medio').textContent = formatarNumero(mediaTotal) + ' min';
                
                // Atualizar tabela de médias por caminhão
                atualizarTabelaMediasCaminhoes(caminhoesExibidos);
                
                // Atualizar tabela de histórico de caminhões
                atualizarTabelaHistoricoCaminhoes(caminhoesExibidos);
                
            } catch (e) {
                console.error("Erro ao atualizar dados de caminhões:", e);
            }
        }
        
        // Atualizar tabela de médias por caminhão
        function atualizarTabelaMediasCaminhoes(caminhoes) {
            try {
                const tbody = document.getElementById('tabela-medias-caminhoes');
                if (!tbody) return;
                
                if (!caminhoes || caminhoes.length === 0) {
                    tbody.innerHTML = '<tr><td colspan="4" class="px-4 py-4 text-center text-gray-500 dark:text-gray-400">Nenhum registro de caminhão</td></tr>';
                    return;
                }
                
                // Agrupar por ID de caminhão
                const caminhoesPorId = new Map();
                
                caminhoes.forEach(c => {
                    if (!c.idCaminhao) return;
                    
                    if (!caminhoesPorId.has(c.idCaminhao)) {
                        caminhoesPorId.set(c.idCaminhao, {
                            id: c.idCaminhao,
                            registros: [],
                            tempoCampoTotal: 0,
                            tempoPatioTotal: 0,
                            tempoTotal: 0
                        });
                    }
                    
                    const dados = caminhoesPorId.get(c.idCaminhao);
                    dados.registros.push(c);
                    dados.tempoCampoTotal += Number(c.tempoCampo) || 0;
                    dados.tempoPatioTotal += Number(c.tempoPatio) || 0;
                    dados.tempoTotal += (Number(c.tempoCampo) || 0) + (Number(c.tempoPatio) || 0);
                });
                
                // Calcular médias e criar linhas da tabela
                tbody.innerHTML = '';
                
                for (const [id, dados] of caminhoesPorId.entries()) {
                    const tempoCampoMedio = dados.registros.length > 0 ? dados.tempoCampoTotal / dados.registros.length : 0;
                    const tempoPatioMedio = dados.registros.length > 0 ? dados.tempoPatioTotal / dados.registros.length : 0;
                    const tempoTotalMedio = dados.registros.length > 0 ? dados.tempoTotal / dados.registros.length : 0;
                    
                    const tr = document.createElement('tr');
                    tr.innerHTML = `
                        <td class="px-4 py-3">${id}</td>
                        <td class="px-4 py-3 text-right">${formatarNumero(tempoCampoMedio)}</td>
                        <td class="px-4 py-3 text-right">${formatarNumero(tempoPatioMedio)}</td>
                        <td class="px-4 py-3 text-right">${formatarNumero(tempoTotalMedio)}</td>
                    `;
                    tbody.appendChild(tr);
                }
                
            } catch (e) {
                console.error("Erro ao atualizar tabela de médias por caminhão:", e);
            }
        }
        
        // Atualizar tabela de histórico de caminhões
        function atualizarTabelaHistoricoCaminhoes(caminhoes) {
            try {
                const tbody = document.getElementById('tabela-historico-caminhoes');
                if (!tbody) return;
                
                if (!caminhoes || caminhoes.length === 0) {
                    tbody.innerHTML = '<tr><td colspan="6" class="px-4 py-4 text-center text-gray-500 dark:text-gray-400">Nenhum registro encontrado</td></tr>';
                    return;
                }
                
                // Ordenar por data (mais recente primeiro)
                const caminhoesOrdenados = [...caminhoes].sort((a, b) => new Date(b.data) - new Date(a.data));
                
                // Criar linhas da tabela
                tbody.innerHTML = '';
                
                caminhoesOrdenados.forEach(c => {
                    const tempoTotal = (Number(c.tempoCampo) || 0) + (Number(c.tempoPatio) || 0);
                    
                    const tr = document.createElement('tr');
                    tr.innerHTML = `
                        <td class="px-4 py-3">${formatarData(c.data)}</td>
                        <td class="px-4 py-3">${c.idCaminhao}</td>
                        <td class="px-4 py-3 text-right">${formatarNumero(c.tempoCampo)}</td>
                        <td class="px-4 py-3 text-right">${formatarNumero(c.tempoPatio)}</td>
                        <td class="px-4 py-3 text-right">${formatarNumero(tempoTotal)}</td>
                        <td class="px-4 py-3 text-center admin-only">
                            <button data-id="${c.id}" class="btn-excluir-caminhao text-red-600 hover:text-red-800 dark:text-red-400 dark:hover:text-red-300" title="Excluir registro">
                                <i class="fas fa-trash-alt"></i>
                            </button>
                        </td>
                    `;
                    tbody.appendChild(tr);
                });
                
                // Adicionar event listeners para botões de exclusão
                document.querySelectorAll('.btn-excluir-caminhao').forEach(btn => {
                    btn.addEventListener('click', function() {
                        const camId = this.getAttribute('data-id');
                        excluirCaminhao(camId);
                    });
                });
                
            } catch (e) {
                console.error("Erro ao atualizar tabela de histórico de caminhões:", e);
            }
        }
        
        // Gerenciamento de Usuários
        
        // Carregar lista de usuários
        function carregarUsuarios() {
            try {
                const users = DB.users.getAll();
                const tbody = document.getElementById('tabela-usuarios');
                
                if (!tbody) {
                    console.error("Elemento tabela-usuarios não encontrado");
                    return;
                }
                
                if (users.length === 0) {
                    tbody.innerHTML = '<tr><td colspan="4" class="px-4 py-4 text-center text-gray-500 dark:text-gray-400">Nenhum usuário cadastrado</td></tr>';
                    return;
                }
                
                tbody.innerHTML = '';
                
                users.forEach(user => {
                    if (!user || !user.id) return;
                    
                    const tr = document.createElement('tr');
                    
                    // Não permitir excluir o próprio usuário
                    const isCurrentUser = estado.user && estado.user.id === user.id;
                    const deleteButton = isCurrentUser ? 
                        `<button class="text-gray-400 cursor-not-allowed" disabled title="Não é possível excluir seu próprio usuário">
                            <i class="fas fa-trash-alt"></i>
                        </button>` : 
                        `<button class="btn-excluir-usuario text-red-600 hover:text-red-700" data-id="${user.id}" title="Excluir usuário">
                            <i class="fas fa-trash-alt"></i>
                        </button>`;
                    
                    tr.innerHTML = `
                        <td class="px-4 py-3">${user.name || ''}</td>
                        <td class="px-4 py-3">${user.email || ''}</td>
                        <td class="px-4 py-3 text-center">
                            <span class="px-2 py-1 rounded text-xs font-medium ${user.isAdmin ? 
                                'bg-red-100 text-red-800 dark:bg-red-900/30 dark:text-red-400' : 
                                'bg-blue-100 text-blue-800 dark:bg-blue-900/30 dark:text-blue-400'}">
                                ${user.isAdmin ? 'Administrador' : 'Usuário'}
                            </span>
                        </td>
                        <td class="px-4 py-3 text-center">
                            ${deleteButton}
                        </td>
                    `;
                    
                    tbody.appendChild(tr);
                });
                
                // Adicionar event listeners para botões de exclusão
                document.querySelectorAll('.btn-excluir-usuario').forEach(btn => {
                    btn.addEventListener('click', function() {
                        const userId = this.getAttribute('data-id');
                        if (userId) {
                            document.getElementById('usuario-excluir-id').value = userId;
                            document.getElementById('modal-excluir-usuario').classList.remove('hidden');
                        }
                    });
                });
            } catch (e) {
                console.error("Erro ao carregar usuários:", e);
                mostrarToast("Erro ao carregar lista de usuários", "error");
            }
        }
        
        // Adicionar novo usuário
        function adicionarUsuario(nome, email, senha, isAdmin) {
            try {
                // Verificar se email já existe
                const existingUser = DB.users.getByEmail(email);
                if (existingUser) {
                    mostrarToast("Email já cadastrado", "error");
                    return false;
                }
                
                // Criar novo usuário
                const novoUsuario = {
                    name: nome,
                    email: email,
                    password: senha,
                    isAdmin: isAdmin
                };
                
                DB.users.add(novoUsuario);
                
                // Atualizar lista de usuários
                carregarUsuarios();
                
                return true;
            } catch (e) {
                console.error("Erro ao adicionar usuário:", e);
                mostrarToast("Erro ao adicionar usuário: " + e.message, "error");
                return false;
            }
        }
        
        // Excluir usuário
        function excluirUsuario(userId) {
            try {
                // Não permitir excluir o próprio usuário
                if (userId === estado.user.id) {
                    mostrarToast("Não é possível excluir seu próprio usuário", "error");
                    return false;
                }
                
                // Verificar se é o último administrador
                const user = DB.users.get(userId);
                if (user && user.isAdmin) {
                    const admins = DB.users.getAll().filter(u => u.isAdmin);
                    if (admins.length <= 1) {
                        mostrarToast("Não é possível excluir o único administrador", "error");
                        return false;
                    }
                }
                
                // Excluir usuário
                DB.users.remove(userId);
                
                // Atualizar lista de usuários
                carregarUsuarios();
                
                return true;
            } catch (e) {
                console.error("Erro ao excluir usuário:", e);
                mostrarToast("Erro ao excluir usuário: " + e.message, "error");
                return false;
            }
        }
        
        // Excluir registro de produção
        function excluirRegistro(regId) {
            try {
                if (!Auth.isAdmin()) {
                    mostrarToast("Apenas administradores podem excluir registros", "error");
                    return false;
                }
                
                // Excluir registro
                DB.registros.remove(regId);
                
                // Atualizar estado e interface
                estado.registros = DB.registros.getAll();
                atualizarTabelaRegistros();
                atualizarDashboard();
                atualizarResumoProducao();
                atualizarListaColhedoras();
                
                mostrarToast("Registro excluído com sucesso", "success");
                return true;
            } catch (e) {
                console.error("Erro ao excluir registro:", e);
                mostrarToast("Erro ao excluir registro: " + e.message, "error");
                return false;
            }
        }
        
        // Excluir registro de caminhão
        function excluirCaminhao(camId) {
            try {
                if (!Auth.isAdmin()) {
                    mostrarToast("Apenas administradores podem excluir registros", "error");
                    return false;
                }
                
                // Excluir registro
                DB.caminhoes.remove(camId);
                
                // Atualizar estado e interface
                estado.caminhoes = DB.caminhoes.getAll();
                atualizarDadosCaminhoes();
                
                mostrarToast("Registro de caminhão excluído com sucesso", "success");
                return true;
            } catch (e) {
                console.error("Erro ao excluir registro de caminhão:", e);
                mostrarToast("Erro ao excluir registro: " + e.message, "error");
                return false;
            }
        }
        
        // Funções para atualização da interface
        
        // Atualizar selects de colhedoras
        function atualizarSelectColhedoras() {
            try {
                const selects = [
                    document.getElementById('colhedora-select'),
                    document.getElementById('filtro-colhedora')
                ];
                
                selects.forEach(select => {
                    if (!select) return;
                    
                    // Guardar valor selecionado atual
                    const valorAtual = select.value;
                    
                    // Limpar select
                    select.innerHTML = '';
                    
                    // Adicionar opção padrão
                    const optionPadrao = document.createElement('option');
                    optionPadrao.value = '';
                    optionPadrao.textContent = select.id === 'filtro-colhedora' ? 'Todas' : 'Selecione uma colhedora...';
                    select.appendChild(optionPadrao);
                    
                    // Adicionar colhedoras
                    estado.colhedoras.forEach(colhedora => {
                        if (!colhedora || !colhedora.id) return;
                        
                        const option = document.createElement('option');
                        option.value = colhedora.id;
                        option.textContent = `${colhedora.id} - ${colhedora.modelo || ''}`;
                        select.appendChild(option);
                    });
                    
                    // Restaurar valor selecionado
                    if (valorAtual && select.querySelector(`option[value="${valorAtual}"]`)) {
                        select.value = valorAtual;
                    }
                });
            } catch (e) {
                console.error("Erro ao atualizar selects de colhedoras:", e);
            }
        }
        
        // Atualizar lista de colhedoras
        function atualizarListaColhedoras() {
            try {
                const container = document.getElementById('lista-colhedoras-container');
                if (!container) return;
                
                if (!estado.colhedoras || estado.colhedoras.length === 0) {
                    container.innerHTML = `
                        <div class="text-gray-500 dark:text-gray-400 text-center py-10">
                            <i class="fas fa-tractor text-5xl mb-3 text-gray-300 dark:text-gray-600"></i>
                            <p>Nenhuma colhedora cadastrada</p>
                        </div>
                    `;
                    return;
                }
                
                container.innerHTML = '';
                
                estado.colhedoras.forEach(colhedora => {
                    if (!colhedora || !colhedora.id) return;
                    
                    // Calcular estatísticas da colhedora
                    const registrosColhedora = estado.registros.filter(r => r && r.colhedoraId === colhedora.id);
                    
                    let totalColhido = 0;
                    let areaTotal = 0;
                    let horasTotal = 0;
                    
                    registrosColhedora.forEach(reg => {
                        if (!reg) return;
                        totalColhido += Number(reg.quantidade) || 0;
                        areaTotal += Number(reg.area) || 0;
                        horasTotal += Number(reg.horas) || 0;
                    });
                    
                    const produtividade = areaTotal > 0 ? totalColhido / areaTotal : 0;
                    const rendimento = horasTotal > 0 ? totalColhido / horasTotal : 0;
                    
                    // Atualizar estatísticas da colhedora no objeto
                    colhedora.totalColhido = totalColhido;
                    colhedora.areaTotal = areaTotal;
                    colhedora.horasTotal = horasTotal;
                    
                    const card = document.createElement('div');
                    card.className = "bg-gray-50 dark:bg-gray-700 rounded-lg p-4 mb-3";
                    
                    // Botões administrativos só aparecem para admins
                    const adminButtons = Auth.isAdmin() ? `
                        <div class="flex space-x-2">
                            <button data-id="${colhedora.id}" class="btn-editar-colhedora text-primary-600 hover:text-primary-800 dark:text-primary-400 dark:hover:text-primary-300">
                                <i class="fas fa-pencil-alt"></i>
                            </button>
                            <button data-id="${colhedora.id}" class="btn-excluir-colhedora text-red-600 hover:text-red-800 dark:text-red-400 dark:hover:text-red-300">
                                <i class="fas fa-trash-alt"></i>
                            </button>
                        </div>
                    ` : '';
                    
                    card.innerHTML = `
                        <div class="flex justify-between items-start">
                            <div>
                                <h4 class="font-semibold text-gray-800 dark:text-gray-100">${colhedora.id}</h4>
                                <p class="text-gray-500 dark:text-gray-400 text-sm">${colhedora.modelo || ''}</p>
                            </div>
                            ${adminButtons}
                        </div>
                        
                        <div class="grid grid-cols-2 mt-3 gap-2">
                            <div>
                                <p class="text-gray-500 dark:text-gray-400 text-xs">Total Colhido</p>
                                <p class="font-semibold">${formatarNumero(totalColhido)} T</p>
                            </div>
                            <div>
                                <p class="text-gray-500 dark:text-gray-400 text-xs">Área Total</p>
                                <p class="font-semibold">${formatarNumero(areaTotal, 2)} ha</p>
                            </div>
                            <div>
                                <p class="text-gray-500 dark:text-gray-400 text-xs">Produtividade</p>
                                <p class="font-semibold">${formatarNumero(produtividade, 2)} T/ha</p>
                            </div>
                            <div>
                                <p class="text-gray-500 dark:text-gray-400 text-xs">Rendimento</p>
                                <p class="font-semibold">${formatarNumero(rendimento, 2)} T/h</p>
                            </div>
                        </div>
                    `;
                    
                    container.appendChild(card);
                });
                
                // Adicionar event listeners para botões de edição e exclusão
                if (Auth.isAdmin()) {
                    document.querySelectorAll('.btn-editar-colhedora').forEach(btn => {
                        btn.addEventListener('click', function() {
                            const colhedoraId = this.getAttribute('data-id');
                            editarColhedora(colhedoraId);
                        });
                    });
                    
                    document.querySelectorAll('.btn-excluir-colhedora').forEach(btn => {
                        btn.addEventListener('click', function() {
                            const colhedoraId = this.getAttribute('data-id');
                            excluirColhedora(colhedoraId);
                        });
                    });
                }
            } catch (e) {
                console.error("Erro ao atualizar lista de colhedoras:", e);
            }
        }
        
        // Registrar Produção
        function registrarProducao(e) {
            e.preventDefault();
            
            try {
                if (!Auth.isAdmin()) {
                    mostrarToast('Você não tem permissão para registrar produção', 'error');
                    return;
                }
                
                // Obter dados do formulário
                const colhedoraId = document.getElementById('colhedora-select').value;
                const data = document.getElementById('data-producao').value;
                const cultura = document.getElementById('cultura-producao').value;
                const quantidade = parseFloat(document.getElementById('qtd-colhida').value);
                const area = parseFloat(document.getElementById('area-colhida').value);
                const horas = parseFloat(document.getElementById('horas-trabalhadas').value);
                const combustivel = document.getElementById('combustivel').value ? parseFloat(document.getElementById('combustivel').value) : 0;
                const observacoes = document.getElementById('observacoes').value;
                
                // Validar dados
                if (!colhedoraId || !data || !quantidade || !area || !horas) {
                    mostrarToast('Preencha todos os campos obrigatórios', 'warning');
                    return;
                }
                
                // Criar registro
                const registro = {
                    colhedoraId,
                    data,
                    cultura,
                    quantidade,
                    area,
                    horas,
                    combustivel,
                    observacoes,
                    produtividade: area > 0 ? quantidade / area : 0,
                    rendimento: horas > 0 ? quantidade / horas : 0
                };
                
                // Adicionar ao banco
                DB.registros.add(registro);
                
                // Atualizar estado
                estado.registros = DB.registros.getAll();
                
                // Limpar formulário
                document.getElementById('form-producao').reset();
                const dataHoje = new Date().toISOString().split('T')[0];
                document.getElementById('data-producao').value = dataHoje;
                
                mostrarToast('Produção registrada com sucesso!', 'success');
                
                // Atualizar interface
                atualizarDashboard();
                atualizarResumoProducao();
                atualizarListaColhedoras();
                
            } catch (error) {
                console.error("Erro ao registrar produção:", error);
                mostrarToast(error.message || 'Erro ao registrar produção', 'error');
            }
        }
        
        // Registrar Tempo de Caminhão
        function registrarTempoCaminhao(e) {
            e.preventDefault();
            
            try {
                if (!Auth.isAdmin()) {
                    mostrarToast('Você não tem permissão para registrar tempo de caminhão', 'error');
                    return;
                }
                
                // Obter dados do formulário
                const idCaminhao = document.getElementById('id-caminhao').value;
                const data = document.getElementById('data-caminhao').value;
                const tempoCampo = parseInt(document.getElementById('tempo-campo').value);
                const tempoPatio = parseInt(document.getElementById('tempo-patio').value);
                const observacoes = document.getElementById('observacoes-caminhao').value;
                
                // Validar dados
                if (!idCaminhao || !data || isNaN(tempoCampo) || isNaN(tempoPatio)) {
                    mostrarToast('Preencha todos os campos obrigatórios', 'warning');
                    return;
                }
                
                // Criar registro
                const registro = {
                    idCaminhao,
                    data,
                    tempoCampo,
                    tempoPatio,
                    tempoTotal: tempoCampo + tempoPatio,
                    observacoes
                };
                
                // Adicionar ao banco
                DB.caminhoes.add(registro);
                
                // Atualizar estado
                estado.caminhoes = DB.caminhoes.getAll();
                
                // Limpar formulário
                document.getElementById('form-caminhao').reset();
                const dataHoje = new Date().toISOString().split('T')[0];
                document.getElementById('data-caminhao').value = dataHoje;
                
                mostrarToast('Tempo de caminhão registrado com sucesso!', 'success');
                
                // Atualizar interface
                atualizarDadosCaminhoes();
                atualizarDashboard(); // Atualizar também o dashboard para mostrar os novos dados
                
            } catch (error) {
                console.error("Erro ao registrar tempo de caminhão:", error);
                mostrarToast(error.message || 'Erro ao registrar tempo de caminhão', 'error');
            }
        }
        
        // Excluir colhedora
        function excluirColhedora(colhedoraId) {
            try {
                if (!Auth.isAdmin()) {
                    mostrarToast("Apenas administradores podem excluir colhedoras", "error");
                    return false;
                }
                
                // Verificar se há registros vinculados
                const registrosVinculados = estado.registros.filter(r => r.colhedoraId === colhedoraId).length > 0;
                
                if (registrosVinculados) {
                    mostrarToast("Não é possível excluir uma colhedora com registros vinculados", "error");
                    return false;
                }
                
                // Excluir colhedora
                DB.colhedoras.remove(colhedoraId);
                
                // Atualizar estado e interface
                estado.colhedoras = DB.colhedoras.getAll();
                atualizarListaColhedoras();
                atualizarSelectColhedoras();
                
                mostrarToast("Colhedora excluída com sucesso", "success");
                return true;
            } catch (e) {
                console.error("Erro ao excluir colhedora:", e);
                mostrarToast("Erro ao excluir colhedora: " + e.message, "error");
                return false;
            }
        }
        
        // Editar colhedora (usado quando o usuário clica no botão de edição)
        function editarColhedora(colhedoraId) {
            try {
                if (!Auth.isAdmin()) {
                    mostrarToast("Apenas administradores podem editar colhedoras", "error");
                    return false;
                }
                
                const colhedora = DB.colhedoras.get(colhedoraId);
                if (!colhedora) {
                    mostrarToast("Colhedora não encontrada", "error");
                    return false;
                }
                
                // Preencher formulário com dados da colhedora
                document.getElementById('id-colhedora').value = colhedora.id;
                document.getElementById('modelo-colhedora').value = colhedora.modelo || '';
                document.getElementById('ano-colhedora').value = colhedora.ano || '';
                document.getElementById('potencia-colhedora').value = colhedora.potencia || '';
                
                // Desabilitar campo de ID (não permitir alterar)
                document.getElementById('id-colhedora').disabled = true;
                
                // Rolar para o topo da página
                window.scrollTo(0, 0);
                
                // Mudar texto do botão
                const btnSubmit = document.querySelector('#form-colhedora button[type="submit"]');
                if (btnSubmit) {
                    btnSubmit.innerHTML = '<i class="fas fa-save mr-2"></i> Atualizar Colhedora';
                    btnSubmit.setAttribute('data-edit', colhedoraId);
                }
                
                // Adicionar evento para cancelar edição (botão de cancelar)
                if (!document.getElementById('btn-cancelar-edit')) {
                    const btnCancelar = document.createElement('button');
                    btnCancelar.id = 'btn-cancelar-edit';
                    btnCancelar.type = 'button';
                    btnCancelar.className = 'w-full bg-gray-500 hover:bg-gray-600 text-white px-4 py-2 rounded-lg transition duration-200 flex items-center justify-center mt-2';
                    btnCancelar.innerHTML = '<i class="fas fa-times mr-2"></i> Cancelar Edição';
                    btnCancelar.addEventListener('click', cancelarEdicaoColhedora);
                    
                    btnSubmit.parentNode.appendChild(btnCancelar);
                }
                
                mostrarToast("Editando colhedora: " + colhedora.id, "info");
                
                // Modificar handler do formulário para atualizar em vez de adicionar
                document.getElementById('form-colhedora').onsubmit = function(e) {
                    e.preventDefault();
                    
                    const modelo = document.getElementById('modelo-colhedora').value;
                    const ano = document.getElementById('ano-colhedora').value;
                    const potencia = document.getElementById('potencia-colhedora').value;
                    
                    // Atualizar dados
                    colhedora.modelo = modelo;
                    colhedora.ano = ano ? parseInt(ano) : null;
                    colhedora.potencia = potencia ? parseInt(potencia) : null;
                    
                    // Salvar no banco
                    DB.colhedoras.update(colhedora);
                    
                    // Atualizar estado
                    estado.colhedoras = DB.colhedoras.getAll();
                    
                    // Restaurar formulário
                    cancelarEdicaoColhedora();
                    
                    // Atualizar interface
                    atualizarListaColhedoras();
                    atualizarSelectColhedoras();
                    
                    mostrarToast("Colhedora atualizada com sucesso", "success");
                };
                
                return true;
            } catch (e) {
                console.error("Erro ao editar colhedora:", e);
                mostrarToast("Erro ao editar colhedora: " + e.message, "error");
                return false;
            }
        }
        
        // Cancelar edição de colhedora
        function cancelarEdicaoColhedora() {
            try {
                // Limpar formulário
                document.getElementById('form-colhedora').reset();
                
                // Habilitar campo de ID
                document.getElementById('id-colhedora').disabled = false;
                
                // Restaurar texto do botão
                const btnSubmit = document.querySelector('#form-colhedora button[type="submit"]');
                if (btnSubmit) {
                    btnSubmit.innerHTML = '<i class="fas fa-plus-circle mr-2"></i> Adicionar Colhedora';
                    btnSubmit.removeAttribute('data-edit');
                }
                
                // Remover botão de cancelar
                const btnCancelar = document.getElementById('btn-cancelar-edit');
                if (btnCancelar) {
                    btnCancelar.remove();
                }
                
                // Restaurar handler original do formulário
                document.getElementById('form-colhedora').onsubmit = function(e) {
                    e.preventDefault();
                    
                    if (!Auth.isAdmin()) {
                        mostrarToast('Você não tem permissão para adicionar colhedoras', 'error');
                        return;
                    }
                    
                    try {
                        const id = document.getElementById('id-colhedora').value;
                        const modelo = document.getElementById('modelo-colhedora').value;
                        const ano = document.getElementById('ano-colhedora').value;
                        const potencia = document.getElementById('potencia-colhedora').value;
                        
                        if (!id || !modelo) {
                            mostrarToast('Preencha todos os campos obrigatórios', 'warning');
                            return;
                        }
                        
                        // Criar colhedora
                        const colhedora = {
                            id,
                            modelo,
                            ano: ano ? parseInt(ano) : null,
                            potencia: potencia ? parseInt(potencia) : null,
                            totalColhido: 0,
                            areaTotal: 0,
                            horasTotal: 0
                        };
                        
                        // Adicionar ao banco
                        DB.colhedoras.add(colhedora);
                        
                        // Atualizar estado e interface
                        estado.colhedoras = DB.colhedoras.getAll();
                        atualizarSelectColhedoras();
                        atualizarListaColhedoras();
                        
                        // Limpar formulário
                        this.reset();
                        
                        mostrarToast('Colhedora adicionada com sucesso!', 'success');
                    } catch (error) {
                        console.error("Erro ao adicionar colhedora:", error);
                        mostrarToast(error.message || 'Erro ao adicionar colhedora', 'error');
                    }
                };
                
            } catch (e) {
                console.error("Erro ao cancelar edição:", e);
                mostrarToast("Erro ao cancelar edição: " + e.message, "error");
            }
        }
        
        // Função para exportar dados
        function exportarDados() {
            try {
                const dadosJSON = DB.exportData();
                
                // Criar um arquivo Blob com os dados
                const blob = new Blob([dadosJSON], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                
                // Criar um link para download e clicar nele automaticamente
                const a = document.createElement('a');
                a.href = url;
                a.download = `ggomes-backup-${new Date().toISOString().split('T')[0]}.json`;
                document.body.appendChild(a);
                a.click();
                
                // Limpar
                setTimeout(() => {
                    document.body.removeChild(a);
                    URL.revokeObjectURL(url);
                }, 100);
                
                mostrarToast("Dados exportados com sucesso!", "success");
            } catch (e) {
                console.error("Erro ao exportar dados:", e);
                mostrarToast("Erro ao exportar dados: " + e.message, "error");
            }
        }
        
        // Função para importar dados
        function importarDados(file) {
            try {
                const reader = new FileReader();
                
                reader.onload = function(e) {
                    try {
                        const jsonData = e.target.result;
                        DB.importData(jsonData);
                        
                        // Recarregar dados
                        carregarDados();
                        
                        mostrarToast("Dados importados com sucesso! O sistema será recarregado.", "success");
                        
                        // Redirecionar para o dashboard após a importação
                        alternarPagina('dashboard');
                    } catch (error) {
                        console.error("Erro ao processar arquivo:", error);
                        mostrarToast("Erro ao importar dados: " + error.message, "error");
                    }
                };
                
                reader.onerror = function() {
                    mostrarToast("Erro ao ler o arquivo", "error");
                };
                
                reader.readAsText(file);
            } catch (e) {
                console.error("Erro ao importar dados:", e);
                mostrarToast("Erro ao importar dados: " + e.message, "error");
            }
        }
        
        // Função para carregar os dados do localStorage
        function carregarDados() {
            try {
                // Carregar configurações
                estado.config = DB.config.get();
                
                // Aplicar tema
                if (estado.config.temaEscuro) {
                    document.documentElement.classList.add('dark');
                } else {
                    document.documentElement.classList.remove('dark');
                }
                
                const toggleSwitch = document.getElementById('toggle-theme-switch');
                if (toggleSwitch) {
                    toggleSwitch.checked = estado.config.temaEscuro;
                }
                
                // Carregar dados
                estado.colhedoras = DB.colhedoras.getAll() || [];
                estado.registros = DB.registros.getAll() || [];
                estado.caminhoes = DB.caminhoes.getAll() || [];
                
                // Atualizar interface
                atualizarSelectColhedoras();
                atualizarListaColhedoras();
                atualizarDashboard();
                atualizarListaCulturas();
                
                // Iniciar na página dashboard
                alternarPagina('dashboard');
            } catch (e) {
                console.error("Erro ao carregar dados:", e);
                mostrarToast("Erro ao carregar dados. Verifique o console para mais detalhes.", "error");
            }
        }
        
        // Event Listeners
        
        // Login
        document.getElementById('btn-login').addEventListener('click', function(e) {
            e.preventDefault();
            
            const email = document.getElementById('login-email').value;
            const password = document.getElementById('login-password').value;
            
            if (!email || !password) {
                mostrarToast("Preencha todos os campos", "warning");
                return;
            }
            
            showAuthLoader();
            
            // Simular delay para mostrar loader
            setTimeout(() => {
                if (Auth.login(email, password)) {
                    // Carregar dados e configurações
                    carregarDados();
                    showApp();
                    mostrarToast(`Bem-vindo, ${estado.user.name}!`, "success");
                } else {
                    hideAuthLoader();
                    mostrarToast("Email ou senha incorretos", "error");
                }
            }, 500);
        });
        
        // Permitir login com tecla Enter
        document.getElementById('login-password').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                document.getElementById('btn-login').click();
            }
        });
        
        // Logout
        document.getElementById('btn-logout').addEventListener('click', function() {
            Auth.logout();
        });
        
        document.getElementById('btn-logout-config').addEventListener('click', function() {
            Auth.logout();
        });
        
        // Formulário para adicionar colhedora
        document.getElementById('form-colhedora').addEventListener('submit', function(e) {
            e.preventDefault();
            
            if (!Auth.isAdmin()) {
                mostrarToast('Você não tem permissão para adicionar colhedoras', 'error');
                return;
            }
            
            try {
                const id = document.getElementById('id-colhedora').value;
                const modelo = document.getElementById('modelo-colhedora').value;
                const ano = document.getElementById('ano-colhedora').value;
                const potencia = document.getElementById('potencia-colhedora').value;
                
                if (!id || !modelo) {
                    mostrarToast('Preencha todos os campos obrigatórios', 'warning');
                    return;
                }
                
                // Criar colhedora
                const colhedora = {
                    id,
                    modelo,
                    ano: ano ? parseInt(ano) : null,
                    potencia: potencia ? parseInt(potencia) : null,
                    totalColhido: 0,
                    areaTotal: 0,
                    horasTotal: 0
                };
                
                // Adicionar ao banco
                DB.colhedoras.add(colhedora);
                
                // Atualizar estado e interface
                estado.colhedoras = DB.colhedoras.getAll();
                atualizarSelectColhedoras();
                atualizarListaColhedoras();
                
                // Limpar formulário
                this.reset();
                
                mostrarToast('Colhedora adicionada com sucesso!', 'success');
            } catch (error) {
                console.error("Erro ao adicionar colhedora:", error);
                mostrarToast(error.message || 'Erro ao adicionar colhedora', 'error');
            }
        });
        
        // Formulário para registrar produção
        document.getElementById('form-producao').addEventListener('submit', function(e) {
            registrarProducao(e);
        });
        
        // Formulário para registrar tempo de caminhão
        document.getElementById('form-caminhao').addEventListener('submit', function(e) {
            registrarTempoCaminhao(e);
        });
        
        // Botões de paginação
        document.getElementById('btn-pagina-anterior').addEventListener('click', function() {
            if (estado.paginacao.paginaAtual > 1) {
                estado.paginacao.paginaAtual--;
                atualizarTabelaRegistros();
            }
        });
        
        document.getElementById('btn-proxima-pagina').addEventListener('click', function() {
            if (estado.paginacao.paginaAtual < estado.paginacao.totalPaginas) {
                estado.paginacao.paginaAtual++;
                atualizarTabelaRegistros();
            }
        });
        
        // Filtros de registros
        document.getElementById('btn-aplicar-filtros').addEventListener('click', function() {
            estado.filtros.colhedora = document.getElementById('filtro-colhedora').value;
            estado.filtros.cultura = document.getElementById('filtro-cultura').value;
            estado.filtros.dataInicio = document.getElementById('filtro-data-inicio').value;
            estado.filtros.dataFim = document.getElementById('filtro-data-fim').value;
            
            estado.paginacao.paginaAtual = 1; // Voltar para a primeira página
            atualizarTabelaRegistros();
        });
        
        document.getElementById('btn-limpar-filtros').addEventListener('click', function() {
            document.getElementById('filtro-colhedora').value = '';
            document.getElementById('filtro-cultura').value = '';
            document.getElementById('filtro-data-inicio').value = '';
            document.getElementById('filtro-data-fim').value = '';
            
            estado.filtros.colhedora = '';
            estado.filtros.cultura = '';
            estado.filtros.dataInicio = '';
            estado.filtros.dataFim = '';
            
            estado.paginacao.paginaAtual = 1; // Voltar para a primeira página
            atualizarTabelaRegistros();
        });
        
        // Formulário para adicionar usuário
        document.getElementById('form-usuario').addEventListener('submit', function(e) {
            e.preventDefault();
            
            if (!Auth.isAdmin()) {
                mostrarToast('Apenas administradores podem adicionar usuários', 'error');
                return;
            }
            
            const nome = document.getElementById('nome-usuario').value;
            const email = document.getElementById('email-usuario').value;
            const senha = document.getElementById('senha-usuario').value;
            const isAdmin = document.querySelector('input[name="tipo-usuario"]:checked').value === 'admin';
            
            if (!nome || !email || !senha) {
                mostrarToast('Preencha todos os campos obrigatórios', 'warning');
                return;
            }
            
            if (senha.length < 6) {
                mostrarToast('A senha deve ter pelo menos 6 caracteres', 'warning');
                return;
            }
            
            // Adicionar usuário
            if (adicionarUsuario(nome, email, senha, isAdmin)) {
                this.reset();
                mostrarToast('Usuário adicionado com sucesso!', 'success');
            }
        });
        
        // Modal de exclusão de usuário
        document.getElementById('btn-cancelar-excluir-usuario').addEventListener('click', function() {
            document.getElementById('modal-excluir-usuario').classList.add('hidden');
        });
        
        document.getElementById('btn-confirmar-excluir-usuario').addEventListener('click', function() {
            const userId = document.getElementById('usuario-excluir-id').value;
            if (excluirUsuario(userId)) {
                document.getElementById('modal-excluir-usuario').classList.add('hidden');
                mostrarToast('Usuário excluído com sucesso!', 'success');
            }
        });
        
        // Backup e restauração
        document.getElementById('btn-backup').addEventListener('click', exportarDados);
        document.getElementById('btn-export-data').addEventListener('click', exportarDados);
        
        document.getElementById('input-import').addEventListener('change', function(e) {
            if (e.target.files.length > 0) {
                if (confirm('Importar dados substituirá todos os dados atuais. Deseja continuar?')) {
                    importarDados(e.target.files[0]);
                }
                // Limpar o input para permitir selecionar o mesmo arquivo novamente
                e.target.value = '';
            }
        });
        
        // Filtro de data para caminhões
        document.getElementById('data-filtro-caminhoes').addEventListener('change', function() {
            atualizarDadosCaminhoes();
        });
        
        // Tema
        document.getElementById('toggle-theme').addEventListener('click', function() {
            alternarTema();
        });
        
        document.getElementById('toggle-theme-switch').addEventListener('change', function() {
            alternarTema();
        });
        
        // Navegação
        document.querySelectorAll('.sidebar-link').forEach(link => {
            link.addEventListener('click', function(e) {
                e.preventDefault();
                const pagina = this.getAttribute('href').substring(1);
                alternarPagina(pagina);
            });
        });
        
        // Dashboard - Seletor de período
        document.getElementById('dashboard-period').addEventListener('change', function() {
            estado.dashboard.period = Number(this.value);
            atualizarDashboard();
        });
        
        // Dashboard - Botão de atualizar
        document.getElementById('refresh-dashboard').addEventListener('click', function() {
            atualizarDashboard();
            mostrarToast("Dashboard atualizado com sucesso", "success");
        });
        
        // Dashboard - Tabs de estatísticas
        document.querySelectorAll('.dashboard-tab').forEach(tab => {
            tab.addEventListener('click', function() {
                // Remover classe ativa de todas as tabs
                document.querySelectorAll('.dashboard-tab').forEach(t => {
                    t.classList.remove('tab-active');
                });
                
                // Adicionar classe ativa à tab clicada
                this.classList.add('tab-active');
                
                // Esconder todos os conteúdos
                document.querySelectorAll('.dashboard-tab-content').forEach(content => {
                    content.classList.add('hidden');
                });
                
                // Mostrar conteúdo correspondente
                const tabId = this.getAttribute('data-tab');
                document.getElementById('tab-' + tabId).classList.remove('hidden');
            });
        });
        
        // Limpar dados
        document.getElementById('btn-limpar-dados').addEventListener('click', function() {
            document.getElementById('modal-limpar-dados').classList.remove('hidden');
            document.getElementById('modal-limpar-dados').classList.add('flex');
        });
        
        document.getElementById('confirmacao-texto').addEventListener('input', function() {
            const btnConfirmar = document.getElementById('btn-confirmar-limpar');
            if (this.value === 'CONFIRMAR') {
                btnConfirmar.disabled = false;
                btnConfirmar.classList.remove('opacity-50', 'cursor-not-allowed');
            } else {
                btnConfirmar.disabled = true;
                btnConfirmar.classList.add('opacity-50', 'cursor-not-allowed');
            }
        });
        
        document.getElementById('btn-cancelar-limpar').addEventListener('click', function() {
            document.getElementById('modal-limpar-dados').classList.add('hidden');
            document.getElementById('modal-limpar-dados').classList.remove('flex');
        });
        
        document.getElementById('btn-confirmar-limpar').addEventListener('click', function() {
            if (document.getElementById('confirmacao-texto').value !== 'CONFIRMAR') {
                return;
            }
            
            try {
                // Limpar todos os dados
                DB.clearAll();
                
                // Resetar estado
                estado.colhedoras = [];
                estado.registros = [];
                estado.caminhoes = [];
                
                document.getElementById('modal-limpar-dados').classList.add('hidden');
                document.getElementById('modal-limpar-dados').classList.remove('flex');
                
                // Limpar campo de confirmação
                document.getElementById('confirmacao-texto').value = '';
                
                mostrarToast("Todos os dados foram limpos com sucesso", "success");
                
                // Recarregar interface
                carregarDados();
            } catch (e) {
                console.error("Erro ao limpar dados:", e);
                mostrarToast("Erro ao limpar dados: " + e.message, "error");
            }
        });
        
        // Exportar para PDF
        document.getElementById('btn-exportar').addEventListener('click', function() {
            try {
                const { jsPDF } = window.jspdf;
                const doc = new jsPDF();
                
                // Título
                doc.setFontSize(16);
                doc.text("Relatório de Produção - GGOMES-LOG", 14, 20);
                
                // Data de geração
                doc.setFontSize(10);
                doc.text(`Gerado em: ${new Date().toLocaleDateString('pt-BR')}`, 14, 28);
                
                // Filtros aplicados
                doc.setFontSize(12);
                doc.text("Filtros aplicados:", 14, 40);
                
                const filtros = [];
                if (estado.filtros.colhedora) {
                    const colhedora = estado.colhedoras.find(c => c.id === estado.filtros.colhedora);
                    filtros.push(`Colhedora: ${colhedora ? colhedora.id : estado.filtros.colhedora}`);
                }
                if (estado.filtros.cultura) filtros.push(`Cultura: ${estado.filtros.cultura}`);
                if (estado.filtros.dataInicio) filtros.push(`Data Inicial: ${formatarData(estado.filtros.dataInicio)}`);
                if (estado.filtros.dataFim) filtros.push(`Data Final: ${formatarData(estado.filtros.dataFim)}`);
                
                if (filtros.length === 0) {
                    filtros.push("Nenhum filtro aplicado");
                }
                
                let y = 45;
                filtros.forEach(filtro => {
                    doc.text(`• ${filtro}`, 16, y);
                    y += 6;
                });
                
                // Dados para o relatório
                let registrosFiltrados = [...estado.registros];
                
                if (estado.filtros.colhedora) {
                    registrosFiltrados = registrosFiltrados.filter(r => r.colhedoraId === estado.filtros.colhedora);
                }
                
                if (estado.filtros.cultura) {
                    registrosFiltrados = registrosFiltrados.filter(r => r.cultura === estado.filtros.cultura);
                }
                
                if (estado.filtros.dataInicio) {
                    const dataInicio = new Date(estado.filtros.dataInicio);
                    registrosFiltrados = registrosFiltrados.filter(r => new Date(r.data) >= dataInicio);
                }
                
                if (estado.filtros.dataFim) {
                    const dataFim = new Date(estado.filtros.dataFim);
                    dataFim.setHours(23, 59, 59, 999); // Fim do dia
                    registrosFiltrados = registrosFiltrados.filter(r => new Date(r.data) <= dataFim);
                }
                
                // Ordenar por data (mais recente primeiro)
                registrosFiltrados.sort((a, b) => new Date(b.data) - new Date(a.data));
                
                // Tabela de dados
                const tableData = [];
                const tableColumns = [
                    { header: 'Data', dataKey: 'data' },
                    { header: 'Colhedora', dataKey: 'colhedora' },
                    { header: 'Cultura', dataKey: 'cultura' },
                    { header: 'Qtd. (T)', dataKey: 'qtd' },
                    { header: 'Área (ha)', dataKey: 'area' },
                    { header: 'Prod. (T/ha)', dataKey: 'prod' }
                ];
                
                registrosFiltrados.forEach(reg => {
                    const colhedora = estado.colhedoras.find(c => c.id === reg.colhedoraId) || { id: reg.colhedoraId };
                    const produtividade = reg.area > 0 ? reg.quantidade / reg.area : 0;
                    
                    tableData.push({
                        data: formatarData(reg.data),
                        colhedora: colhedora.id,
                        cultura: reg.cultura || '-',
                        qtd: formatarNumero(reg.quantidade),
                        area: formatarNumero(reg.area, 2),
                        prod: formatarNumero(produtividade, 2)
                    });
                });
                
                y += 10;
                
                // Verifica se há dados para incluir na tabela
                if (tableData.length === 0) {
                    doc.text("Nenhum registro encontrado com os filtros aplicados.", 14, y);
                } else {
                    // Adicionar tabela
                    doc.autoTable({
                        startY: y,
                        head: [tableColumns.map(col => col.header)],
                        body: tableData.map(data => tableColumns.map(col => data[col.dataKey])),
                        theme: 'grid',
                        styles: {
                            fontSize: 8,
                            cellPadding: 2
                        },
                        headStyles: {
                            fillColor: [93, 92, 222],
                            textColor: [255, 255, 255],
                            fontStyle: 'bold'
                        },
                        alternateRowStyles: {
                            fillColor: [240, 240, 240]
                        }
                    });
                    
                    // Resumo final
                    const finalY = doc.previousAutoTable.finalY + 10;
                    
                    // Calcular produtividade e rendimento por colhedora e então média
                    const produtividadesPorColhedora = new Map();
                    
                    // Inicializar para cada colhedora nos registros filtrados
                    const colhedorasUnicas = new Set(registrosFiltrados.map(r => r.colhedoraId));
                    colhedorasUnicas.forEach(colhedoraId => {
                        produtividadesPorColhedora.set(colhedoraId, {
                            quantidade: 0,
                            area: 0,
                            produtividade: 0
                        });
                    });
                    
                    // Calcular acumulados por colhedora
                    registrosFiltrados.forEach(reg => {
                        if (!reg || !reg.colhedoraId) return;
                        
                        const prodStats = produtividadesPorColhedora.get(reg.colhedoraId);
                        
                        if (prodStats) {
                            prodStats.quantidade += Number(reg.quantidade) || 0;
                            prodStats.area += Number(reg.area) || 0;
                        }
                    });
                    
                    // Calcular produtividade média
                    let produtividadeTotal = 0;
                    let colhedorasComProducao = 0;
                    let totalColhido = 0;
                    let areaTotal = 0;
                    
                    produtividadesPorColhedora.forEach(stats => {
                        totalColhido += stats.quantidade;
                        areaTotal += stats.area;
                        
                        if (stats.area > 0) {
                            stats.produtividade = stats.quantidade / stats.area;
                            produtividadeTotal += stats.produtividade;
                            colhedorasComProducao++;
                        }
                    });
                    
                    const produtividadeMedia = colhedorasComProducao > 0 ? produtividadeTotal / colhedorasComProducao : 0;
                    
                    doc.setFontSize(11);
                    doc.text("Resumo:", 14, finalY);
                    doc.text(`Total Colhido: ${formatarNumero(totalColhido)} T`, 14, finalY + 6);
                    doc.text(`Área Total: ${formatarNumero(areaTotal, 2)} ha`, 14, finalY + 12);
                    doc.text(`Produtividade Média: ${formatarNumero(produtividadeMedia, 2)} T/ha`, 14, finalY + 18);
                    doc.text(`Quantidade de Registros: ${registrosFiltrados.length}`, 14, finalY + 24);
                }
                
                // Rodapé
                const pageCount = doc.internal.getNumberOfPages();
                for (let i = 1; i <= pageCount; i++) {
                    doc.setPage(i);
                    doc.setFontSize(8);
                    doc.text(`GGOMES-LOG - Sistema de Acompanhamento de Produção - Página ${i} de ${pageCount}`, doc.internal.pageSize.width / 2, doc.internal.pageSize.height - 10, { align: 'center' });
                }
                
                // Salvar o PDF
                doc.save(`relatorio-producao-${new Date().toISOString().split('T')[0]}.pdf`);
                
                mostrarToast("Relatório gerado com sucesso!", "success");
            } catch (e) {
                console.error("Erro ao gerar PDF:", e);
                mostrarToast("Erro ao gerar relatório: " + e.message, "error");
            }
        });
        
        // Registros por página
        document.getElementById('registros-por-pagina').addEventListener('change', function() {
            estado.config.registrosPorPagina = Number(this.value);
            estado.paginacao.registrosPorPagina = Number(this.value);
            estado.paginacao.paginaAtual = 1; // Voltar para a primeira página
            
            // Salvar configuração
            DB.config.update(estado.config);
            
            // Atualizar tabela
            atualizarTabelaRegistros();
        });
        
        // Formato de data
        document.getElementById('formato-data').addEventListener('change', function() {
            estado.config.formatoData = this.value;
            
            // Salvar configuração
            DB.config.update(estado.config);
            
            // Atualizar interface
            atualizarTabelaRegistros();
            atualizarDadosCaminhoes();
        });
        
        // Definir data de hoje nos campos de data quando a página carregar
        window.addEventListener('DOMContentLoaded', function() {
            const dataHoje = new Date().toISOString().split('T')[0];
            
            const camposData = [
                document.getElementById('data-producao'),
                document.getElementById('data-caminhao'),
                document.getElementById('data-filtro-caminhoes')
            ];
            
            camposData.forEach(campo => {
                if (campo) campo.value = dataHoje;
            });
            
            showLoginForm();
        });
        
        // Inicializar aplicação
        document.addEventListener('DOMContentLoaded', function() {
            // Definir valores iniciais para selects de configuração
            document.getElementById('registros-por-pagina').value = estado.config.registrosPorPagina.toString();
            document.getElementById('formato-data').value = estado.config.formatoData;
            
            // Ajustar layout do tema escuro/claro
            const toggleSwitch = document.getElementById('toggle-theme-switch');
            if (toggleSwitch) {
                toggleSwitch.checked = document.documentElement.classList.contains('dark');
            }
            
            // Aplicar estilo para dark mode nas caixas de switch
            if (document.documentElement.classList.contains('dark')) {
                document.querySelectorAll('.dot').forEach(dot => {
                    dot.classList.add('transform', 'translate-x-6');
                });
            }
        });
    </script>
</body>
</html>